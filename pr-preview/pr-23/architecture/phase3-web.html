<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Phase 3: Web Plugin Architecture - litestar-workflows</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Changelog" href="../changelog.html" /><link rel="prev" title="Architecture Documentation" href="index.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=8975404a" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Phase 3: Web Plugin Architecture"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>litestar-workflows</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://pypi.org/project/litestar-workflows/">
            <span>PyPI</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/litestar-workflows" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Learn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/workflows.html">Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/steps.html">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/context.html">Workflow Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/execution.html">Execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">How-To Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/simple-workflow.html">Building a Simple Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/human-tasks.html">Working with Human Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/parallel-execution.html">Parallel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/conditional-logic.html">Conditional Logic and Gateways</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/persistence.html">Database Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/web-plugin.html">Web Plugin (REST API)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/expense-approval.html">Expense Approval Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/document-review.html">Document Review Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/onboarding.html">Employee Onboarding Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/integration-patterns.html">Integration Patterns</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/modules.html">Module Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/web.html">Web Plugin API Reference</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Phase 3: Web Plugin Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JacobCoffee/litestar-workflows">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/litestar-919193495116337154">Discord</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#executive-summary">Executive Summary</a><ul>
<li><a class="reference internal" href="#design-goals">Design Goals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-structure">Module Structure</a><ul>
<li><a class="reference internal" href="#dependency-graph">Dependency Graph</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-design">Plugin Design</a><ul>
<li><a class="reference internal" href="#workflowwebpluginconfig">WorkflowWebPluginConfig</a></li>
<li><a class="reference internal" href="#workflowwebplugin">WorkflowWebPlugin</a></li>
<li><a class="reference internal" href="#plugin-initialization-flow">Plugin Initialization Flow</a></li>
<li><a class="reference internal" href="#route-structure">Route Structure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-hierarchy">Controller Hierarchy</a><ul>
<li><a class="reference internal" href="#base-controller">Base Controller</a></li>
<li><a class="reference internal" href="#workflowdefinitioncontroller">WorkflowDefinitionController</a></li>
<li><a class="reference internal" href="#workflowinstancecontroller">WorkflowInstanceController</a></li>
<li><a class="reference internal" href="#humantaskcontroller">HumanTaskController</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dto-layer-design">DTO Layer Design</a><ul>
<li><a class="reference internal" href="#dto-architecture">DTO Architecture</a></li>
<li><a class="reference internal" href="#request-dtos">Request DTOs</a></li>
<li><a class="reference internal" href="#response-dtos">Response DTOs</a></li>
<li><a class="reference internal" href="#validation-strategy">Validation Strategy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openapi-integration">OpenAPI Integration</a><ul>
<li><a class="reference internal" href="#schema-configuration">Schema Configuration</a></li>
<li><a class="reference internal" href="#response-examples">Response Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guard-integration-patterns">Guard Integration Patterns</a><ul>
<li><a class="reference internal" href="#base-guard-protocol">Base Guard Protocol</a></li>
<li><a class="reference internal" href="#authentication-guard">Authentication Guard</a></li>
<li><a class="reference internal" href="#admin-guard">Admin Guard</a></li>
<li><a class="reference internal" href="#task-ownership-guard">Task Ownership Guard</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mermaidjs-graph-generation">MermaidJS Graph Generation</a><ul>
<li><a class="reference internal" href="#graph-service">Graph Service</a></li>
<li><a class="reference internal" href="#graph-controller">Graph Controller</a></li>
<li><a class="reference internal" href="#graph-response-dto">Graph Response DTO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-injection-patterns">Dependency Injection Patterns</a><ul>
<li><a class="reference internal" href="#repository-providers">Repository Providers</a></li>
<li><a class="reference internal" href="#engine-provider">Engine Provider</a></li>
<li><a class="reference internal" href="#dependency-registration">Dependency Registration</a></li>
<li><a class="reference internal" href="#dependency-composition">Dependency Composition</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exception-handling">Exception Handling</a><ul>
<li><a class="reference internal" href="#web-specific-exceptions">Web-Specific Exceptions</a></li>
<li><a class="reference internal" href="#exception-handlers">Exception Handlers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-example">Integration Example</a><ul>
<li><a class="reference internal" href="#complete-application-setup">Complete Application Setup</a></li>
<li><a class="reference internal" href="#api-usage-examples">API Usage Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-strategy">Testing Strategy</a><ul>
<li><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li><a class="reference internal" href="#integration-tests">Integration Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-checklist">Implementation Checklist</a><ul>
<li><a class="reference internal" href="#phase-3-1-core-infrastructure">Phase 3.1: Core Infrastructure</a></li>
<li><a class="reference internal" href="#phase-3-2-dto-layer">Phase 3.2: DTO Layer</a></li>
<li><a class="reference internal" href="#phase-3-3-controllers">Phase 3.3: Controllers</a></li>
<li><a class="reference internal" href="#phase-3-4-guards">Phase 3.4: Guards</a></li>
<li><a class="reference internal" href="#phase-3-5-graph-service">Phase 3.5: Graph Service</a></li>
<li><a class="reference internal" href="#phase-3-6-di-integration">Phase 3.6: DI Integration</a></li>
<li><a class="reference internal" href="#phase-3-7-testing">Phase 3.7: Testing</a></li>
<li><a class="reference internal" href="#phase-3-8-documentation">Phase 3.8: Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-guide">Migration Guide</a><ul>
<li><a class="reference internal" href="#from-manual-routes">From Manual Routes</a></li>
<li><a class="reference internal" href="#from-v0-3-x">From v0.3.x</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">litestar-workflows</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Architecture Documentation</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Phase 3: Web Plugin Architecture</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="phase-3-web-plugin-architecture">
<h1>Phase 3: Web Plugin Architecture<a class="headerlink" href="#phase-3-web-plugin-architecture" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#executive-summary" id="id1">Executive Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#design-goals" id="id2">Design Goals</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-structure" id="id3">Module Structure</a></p>
<ul>
<li><p><a class="reference internal" href="#dependency-graph" id="id4">Dependency Graph</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#plugin-design" id="id5">Plugin Design</a></p>
<ul>
<li><p><a class="reference internal" href="#workflowwebpluginconfig" id="id6">WorkflowWebPluginConfig</a></p></li>
<li><p><a class="reference internal" href="#workflowwebplugin" id="id7">WorkflowWebPlugin</a></p></li>
<li><p><a class="reference internal" href="#plugin-initialization-flow" id="id8">Plugin Initialization Flow</a></p></li>
<li><p><a class="reference internal" href="#route-structure" id="id9">Route Structure</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controller-hierarchy" id="id10">Controller Hierarchy</a></p>
<ul>
<li><p><a class="reference internal" href="#base-controller" id="id11">Base Controller</a></p></li>
<li><p><a class="reference internal" href="#workflowdefinitioncontroller" id="id12">WorkflowDefinitionController</a></p></li>
<li><p><a class="reference internal" href="#workflowinstancecontroller" id="id13">WorkflowInstanceController</a></p></li>
<li><p><a class="reference internal" href="#humantaskcontroller" id="id14">HumanTaskController</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dto-layer-design" id="id15">DTO Layer Design</a></p>
<ul>
<li><p><a class="reference internal" href="#dto-architecture" id="id16">DTO Architecture</a></p></li>
<li><p><a class="reference internal" href="#request-dtos" id="id17">Request DTOs</a></p></li>
<li><p><a class="reference internal" href="#response-dtos" id="id18">Response DTOs</a></p></li>
<li><p><a class="reference internal" href="#validation-strategy" id="id19">Validation Strategy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#openapi-integration" id="id20">OpenAPI Integration</a></p>
<ul>
<li><p><a class="reference internal" href="#schema-configuration" id="id21">Schema Configuration</a></p></li>
<li><p><a class="reference internal" href="#response-examples" id="id22">Response Examples</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#guard-integration-patterns" id="id23">Guard Integration Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#base-guard-protocol" id="id24">Base Guard Protocol</a></p></li>
<li><p><a class="reference internal" href="#authentication-guard" id="id25">Authentication Guard</a></p></li>
<li><p><a class="reference internal" href="#admin-guard" id="id26">Admin Guard</a></p></li>
<li><p><a class="reference internal" href="#task-ownership-guard" id="id27">Task Ownership Guard</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mermaidjs-graph-generation" id="id28">MermaidJS Graph Generation</a></p>
<ul>
<li><p><a class="reference internal" href="#graph-service" id="id29">Graph Service</a></p></li>
<li><p><a class="reference internal" href="#graph-controller" id="id30">Graph Controller</a></p></li>
<li><p><a class="reference internal" href="#graph-response-dto" id="id31">Graph Response DTO</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependency-injection-patterns" id="id32">Dependency Injection Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#repository-providers" id="id33">Repository Providers</a></p></li>
<li><p><a class="reference internal" href="#engine-provider" id="id34">Engine Provider</a></p></li>
<li><p><a class="reference internal" href="#dependency-registration" id="id35">Dependency Registration</a></p></li>
<li><p><a class="reference internal" href="#dependency-composition" id="id36">Dependency Composition</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exception-handling" id="id37">Exception Handling</a></p>
<ul>
<li><p><a class="reference internal" href="#web-specific-exceptions" id="id38">Web-Specific Exceptions</a></p></li>
<li><p><a class="reference internal" href="#exception-handlers" id="id39">Exception Handlers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#integration-example" id="id40">Integration Example</a></p>
<ul>
<li><p><a class="reference internal" href="#complete-application-setup" id="id41">Complete Application Setup</a></p></li>
<li><p><a class="reference internal" href="#api-usage-examples" id="id42">API Usage Examples</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-strategy" id="id43">Testing Strategy</a></p>
<ul>
<li><p><a class="reference internal" href="#unit-tests" id="id44">Unit Tests</a></p></li>
<li><p><a class="reference internal" href="#integration-tests" id="id45">Integration Tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-checklist" id="id46">Implementation Checklist</a></p>
<ul>
<li><p><a class="reference internal" href="#phase-3-1-core-infrastructure" id="id47">Phase 3.1: Core Infrastructure</a></p></li>
<li><p><a class="reference internal" href="#phase-3-2-dto-layer" id="id48">Phase 3.2: DTO Layer</a></p></li>
<li><p><a class="reference internal" href="#phase-3-3-controllers" id="id49">Phase 3.3: Controllers</a></p></li>
<li><p><a class="reference internal" href="#phase-3-4-guards" id="id50">Phase 3.4: Guards</a></p></li>
<li><p><a class="reference internal" href="#phase-3-5-graph-service" id="id51">Phase 3.5: Graph Service</a></p></li>
<li><p><a class="reference internal" href="#phase-3-6-di-integration" id="id52">Phase 3.6: DI Integration</a></p></li>
<li><p><a class="reference internal" href="#phase-3-7-testing" id="id53">Phase 3.7: Testing</a></p></li>
<li><p><a class="reference internal" href="#phase-3-8-documentation" id="id54">Phase 3.8: Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration-guide" id="id55">Migration Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#from-manual-routes" id="id56">From Manual Routes</a></p></li>
<li><p><a class="reference internal" href="#from-v0-3-x" id="id57">From v0.3.x</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#see-also" id="id58">See Also</a></p></li>
</ul>
</nav>
<section id="executive-summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Executive Summary</a><a class="headerlink" href="#executive-summary" title="Link to this heading">¶</a></h2>
<p>This document defines the architecture for the <code class="docutils literal notranslate"><span class="pre">litestar-workflows[web]</span></code> extra,
which provides REST API endpoints, DTOs, and Litestar integration for managing
workflow definitions, instances, and human tasks. The REST API is built into the
main <code class="docutils literal notranslate"><span class="pre">WorkflowPlugin</span></code> and enabled by default via <code class="docutils literal notranslate"><span class="pre">enable_api=True</span></code>. It builds
on the Phase 2 persistence layer and follows Litestar best practices for controllers,
dependency injection, and OpenAPI schema generation.</p>
<section id="design-goals">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Design Goals</a><a class="headerlink" href="#design-goals" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Zero-Configuration Default</strong>: Works out of the box with sensible defaults</p></li>
<li><p><strong>Full Customization</strong>: Every aspect configurable (routes, guards, DTOs)</p></li>
<li><p><strong>OpenAPI-First</strong>: Auto-generated, comprehensive OpenAPI documentation</p></li>
<li><p><strong>Litestar-Native</strong>: Deep integration with DI, guards, middleware, and plugins</p></li>
<li><p><strong>Type-Safe</strong>: Full typing with DTO validation at boundaries</p></li>
<li><p><strong>Testable</strong>: Easy to test with dependency injection and mocking</p></li>
</ol>
</section>
</section>
<section id="module-structure">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Module Structure</a><a class="headerlink" href="#module-structure" title="Link to this heading">¶</a></h2>
<p>The web plugin module structure follows a layered architecture:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">src/litestar_workflows/web/
</span><span data-line="2">|-- __init__.py              # Public API exports
</span><span data-line="3">|-- plugin.py                # WorkflowWebPlugin implementation
</span><span data-line="4">|-- config.py                # WorkflowWebPluginConfig dataclass
</span><span data-line="5">|-- dependencies.py          # DI providers for engine/repositories
</span><span data-line="6">|
</span><span data-line="7">|-- controllers/             # REST API controllers
</span><span data-line="8">|   |-- __init__.py
</span><span data-line="9">|   |-- definitions.py       # WorkflowDefinitionController
</span><span data-line="10">|   |-- instances.py         # WorkflowInstanceController
</span><span data-line="11">|   |-- tasks.py             # HumanTaskController
</span><span data-line="12">|   |-- admin.py             # WorkflowAdminController
</span><span data-line="13">|   |-- graphs.py            # GraphController (MermaidJS endpoints)
</span><span data-line="14">|
</span><span data-line="15">|-- dto/                     # Data Transfer Objects
</span><span data-line="16">|   |-- __init__.py
</span><span data-line="17">|   |-- base.py              # Base DTO classes and config
</span><span data-line="18">|   |-- definitions.py       # WorkflowDefinition DTOs
</span><span data-line="19">|   |-- instances.py         # WorkflowInstance DTOs
</span><span data-line="20">|   |-- tasks.py             # HumanTask DTOs
</span><span data-line="21">|   |-- graphs.py            # Graph visualization DTOs
</span><span data-line="22">|
</span><span data-line="23">|-- guards/                  # Authentication/authorization guards
</span><span data-line="24">|   |-- __init__.py
</span><span data-line="25">|   |-- base.py              # BaseWorkflowGuard protocol
</span><span data-line="26">|   |-- auth.py              # WorkflowAuthGuard (requires user)
</span><span data-line="27">|   |-- admin.py             # WorkflowAdminGuard (requires admin role)
</span><span data-line="28">|   |-- task.py              # TaskAssigneeGuard (task ownership)
</span><span data-line="29">|
</span><span data-line="30">|-- services/                # Business logic services
</span><span data-line="31">|   |-- __init__.py
</span><span data-line="32">|   |-- workflow.py          # WorkflowService (orchestration)
</span><span data-line="33">|   |-- graph.py             # GraphService (visualization)
</span><span data-line="34">|
</span><span data-line="35">|-- exceptions.py            # Web-specific exception handlers
</span><span data-line="36">|-- openapi.py               # OpenAPI schema customization
</span></pre></div>
</div>
<section id="dependency-graph">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Dependency Graph</a><a class="headerlink" href="#dependency-graph" title="Link to this heading">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">web/plugin.py
</span><span data-line="2">    |
</span><span data-line="3">    +-- web/config.py
</span><span data-line="4">    |
</span><span data-line="5">    +-- web/dependencies.py
</span><span data-line="6">    |       |
</span><span data-line="7">    |       +-- db/repositories.py
</span><span data-line="8">    |       +-- engine/registry.py
</span><span data-line="9">    |       +-- db/engine.py (PersistentExecutionEngine)
</span><span data-line="10">    |
</span><span data-line="11">    +-- web/controllers/*.py
</span><span data-line="12">    |       |
</span><span data-line="13">    |       +-- web/dto/*.py
</span><span data-line="14">    |       +-- web/services/*.py
</span><span data-line="15">    |       +-- web/guards/*.py
</span><span data-line="16">    |
</span><span data-line="17">    +-- web/exceptions.py
</span><span data-line="18">    +-- web/openapi.py
</span></pre></div>
</div>
</section>
</section>
<section id="plugin-design">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Plugin Design</a><a class="headerlink" href="#plugin-design" title="Link to this heading">¶</a></h2>
<section id="workflowwebpluginconfig">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">WorkflowWebPluginConfig</a><a class="headerlink" href="#workflowwebpluginconfig" title="Link to this heading">¶</a></h3>
<p>Configuration dataclass for the web plugin:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="5">    <span class="kn">from</span><span class="w"> </span><span class="nn">litestar.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Guard</span>
</span><span data-line="6">
</span><span data-line="7"><span class="nd">@dataclass</span>
</span><span data-line="8"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowWebPluginConfig</span><span class="p">:</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for the WorkflowWebPlugin.</span>
</span><span data-line="10">
</span><span data-line="11"><span class="sd">    Attributes:</span>
</span><span data-line="12"><span class="sd">        path_prefix: URL prefix for all workflow routes. Defaults to &quot;/workflows&quot;.</span>
</span><span data-line="13"><span class="sd">        enable_api: Enable REST API endpoints. Defaults to True.</span>
</span><span data-line="14"><span class="sd">        enable_admin_api: Enable admin API endpoints. Defaults to True.</span>
</span><span data-line="15"><span class="sd">        enable_graph_api: Enable graph visualization endpoints. Defaults to True.</span>
</span><span data-line="16"><span class="sd">        include_in_schema: Include routes in OpenAPI schema. Defaults to True.</span>
</span><span data-line="17"><span class="sd">        tags: OpenAPI tags for workflow routes.</span>
</span><span data-line="18"><span class="sd">        api_guards: Guards applied to API routes.</span>
</span><span data-line="19"><span class="sd">        admin_guards: Guards applied to admin routes.</span>
</span><span data-line="20"><span class="sd">        task_guards: Guards applied to task completion routes.</span>
</span><span data-line="21"><span class="sd">        dto_config: Custom DTO configuration overrides.</span>
</span><span data-line="22"><span class="sd">        dependency_key_engine: DI key for ExecutionEngine. Defaults to &quot;workflow_engine&quot;.</span>
</span><span data-line="23"><span class="sd">        dependency_key_registry: DI key for WorkflowRegistry. Defaults to &quot;workflow_registry&quot;.</span>
</span><span data-line="24"><span class="sd">        dependency_key_instance_repo: DI key for instance repository.</span>
</span><span data-line="25"><span class="sd">        dependency_key_task_repo: DI key for task repository.</span>
</span><span data-line="26"><span class="sd">        dependency_key_definition_repo: DI key for definition repository.</span>
</span><span data-line="27"><span class="sd">        auto_create_dependencies: Auto-create DI providers. Defaults to True.</span>
</span><span data-line="28"><span class="sd">        session_dependency_key: Key for SQLAlchemy session dependency.</span>
</span><span data-line="29"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="30">
</span><span data-line="31">    <span class="c1"># Route configuration</span>
</span><span data-line="32">    <span class="n">path_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/workflows&quot;</span>
</span><span data-line="33">    <span class="n">enable_api</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="34">    <span class="n">enable_admin_api</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="35">    <span class="n">enable_graph_api</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="36">    <span class="n">include_in_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="37">    <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Workflows&quot;</span><span class="p">])</span>
</span><span data-line="38">
</span><span data-line="39">    <span class="c1"># Security configuration</span>
</span><span data-line="40">    <span class="n">api_guards</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Guard</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="41">    <span class="n">admin_guards</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Guard</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="42">    <span class="n">task_guards</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Guard</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="43">
</span><span data-line="44">    <span class="c1"># DTO configuration</span>
</span><span data-line="45">    <span class="n">dto_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span><span data-line="46">
</span><span data-line="47">    <span class="c1"># Dependency injection keys</span>
</span><span data-line="48">    <span class="n">dependency_key_engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_engine&quot;</span>
</span><span data-line="49">    <span class="n">dependency_key_registry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_registry&quot;</span>
</span><span data-line="50">    <span class="n">dependency_key_instance_repo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_instance_repo&quot;</span>
</span><span data-line="51">    <span class="n">dependency_key_task_repo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_task_repo&quot;</span>
</span><span data-line="52">    <span class="n">dependency_key_definition_repo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_definition_repo&quot;</span>
</span><span data-line="53">
</span><span data-line="54">    <span class="c1"># Auto-configuration</span>
</span><span data-line="55">    <span class="n">auto_create_dependencies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="56">    <span class="n">session_dependency_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;db_session&quot;</span>
</span></pre></div>
</div>
</section>
<section id="workflowwebplugin">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">WorkflowWebPlugin</a><a class="headerlink" href="#workflowwebplugin" title="Link to this heading">¶</a></h3>
<p>The main plugin class implementing <code class="docutils literal notranslate"><span class="pre">InitPluginProtocol</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">InitPluginProtocol</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.app</span><span class="w"> </span><span class="kn">import</span> <span class="n">AppConfig</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.router</span><span class="w"> </span><span class="kn">import</span> <span class="n">Router</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowWebPlugin</span><span class="p">(</span><span class="n">InitPluginProtocol</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Litestar plugin for workflow web routes and API.</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">    This plugin provides:</span>
</span><span data-line="9"><span class="sd">    - REST API endpoints for workflow management</span>
</span><span data-line="10"><span class="sd">    - Human task inbox and completion API</span>
</span><span data-line="11"><span class="sd">    - Graph visualization endpoints (MermaidJS)</span>
</span><span data-line="12"><span class="sd">    - Admin API for workflow administration</span>
</span><span data-line="13"><span class="sd">    - OpenAPI schema with full documentation</span>
</span><span data-line="14">
</span><span data-line="15"><span class="sd">    Example:</span>
</span><span data-line="16"><span class="sd">        Basic usage::</span>
</span><span data-line="17">
</span><span data-line="18"><span class="sd">            from litestar import Litestar</span>
</span><span data-line="19"><span class="sd">            from litestar_workflows.web import WorkflowWebPlugin, WorkflowWebPluginConfig</span>
</span><span data-line="20">
</span><span data-line="21"><span class="sd">            app = Litestar(</span>
</span><span data-line="22"><span class="sd">                plugins=[</span>
</span><span data-line="23"><span class="sd">                    WorkflowWebPlugin(</span>
</span><span data-line="24"><span class="sd">                        config=WorkflowWebPluginConfig(</span>
</span><span data-line="25"><span class="sd">                            path_prefix=&quot;/api/workflows&quot;,</span>
</span><span data-line="26"><span class="sd">                            admin_guards=[AdminGuard],</span>
</span><span data-line="27"><span class="sd">                        )</span>
</span><span data-line="28"><span class="sd">                    )</span>
</span><span data-line="29"><span class="sd">                ]</span>
</span><span data-line="30"><span class="sd">            )</span>
</span><span data-line="31">
</span><span data-line="32"><span class="sd">        With custom guards::</span>
</span><span data-line="33">
</span><span data-line="34"><span class="sd">            from litestar_workflows.web import WorkflowWebPlugin, WorkflowWebPluginConfig</span>
</span><span data-line="35">
</span><span data-line="36"><span class="sd">            config = WorkflowWebPluginConfig(</span>
</span><span data-line="37"><span class="sd">                api_guards=[AuthGuard],</span>
</span><span data-line="38"><span class="sd">                admin_guards=[AdminGuard],</span>
</span><span data-line="39"><span class="sd">                task_guards=[AuthGuard, TaskOwnerGuard],</span>
</span><span data-line="40"><span class="sd">            )</span>
</span><span data-line="41"><span class="sd">            plugin = WorkflowWebPlugin(config=config)</span>
</span><span data-line="42"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="43">
</span><span data-line="44">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_config&quot;</span><span class="p">,)</span>
</span><span data-line="45">
</span><span data-line="46">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">WorkflowWebPluginConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="47">        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">WorkflowWebPluginConfig</span><span class="p">()</span>
</span><span data-line="48">
</span><span data-line="49">    <span class="nd">@property</span>
</span><span data-line="50">    <span class="k">def</span><span class="w"> </span><span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowWebPluginConfig</span><span class="p">:</span>
</span><span data-line="51"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the plugin configuration.&quot;&quot;&quot;</span>
</span><span data-line="52">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>
</span><span data-line="53">
</span><span data-line="54">    <span class="k">def</span><span class="w"> </span><span class="nf">on_app_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="n">AppConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AppConfig</span><span class="p">:</span>
</span><span data-line="55"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the plugin when the Litestar app starts.&quot;&quot;&quot;</span>
</span><span data-line="56">        <span class="c1"># Register dependencies</span>
</span><span data-line="57">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">auto_create_dependencies</span><span class="p">:</span>
</span><span data-line="58">            <span class="bp">self</span><span class="o">.</span><span class="n">_register_dependencies</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span>
</span><span data-line="59">
</span><span data-line="60">        <span class="c1"># Build and register routes</span>
</span><span data-line="61">        <span class="n">routers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_routers</span><span class="p">()</span>
</span><span data-line="62">        <span class="n">app_config</span><span class="o">.</span><span class="n">route_handlers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">routers</span><span class="p">)</span>
</span><span data-line="63">
</span><span data-line="64">        <span class="c1"># Register exception handlers</span>
</span><span data-line="65">        <span class="bp">self</span><span class="o">.</span><span class="n">_register_exception_handlers</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span>
</span><span data-line="66">
</span><span data-line="67">        <span class="c1"># Add OpenAPI tags</span>
</span><span data-line="68">        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_openapi</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span>
</span><span data-line="69">
</span><span data-line="70">        <span class="k">return</span> <span class="n">app_config</span>
</span></pre></div>
</div>
</section>
<section id="plugin-initialization-flow">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Plugin Initialization Flow</a><a class="headerlink" href="#plugin-initialization-flow" title="Link to this heading">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">on_app_init()
</span><span data-line="2">    |
</span><span data-line="3">    +-- _register_dependencies()
</span><span data-line="4">    |       |-- Register engine provider
</span><span data-line="5">    |       |-- Register registry provider
</span><span data-line="6">    |       +-- Register repository providers
</span><span data-line="7">    |
</span><span data-line="8">    +-- _build_routers()
</span><span data-line="9">    |       |-- _create_api_router() (if enable_api)
</span><span data-line="10">    |       |-- _create_admin_router() (if enable_admin_api)
</span><span data-line="11">    |       +-- _create_graph_router() (if enable_graph_api)
</span><span data-line="12">    |
</span><span data-line="13">    +-- _register_exception_handlers()
</span><span data-line="14">    |       |-- WorkflowNotFoundError -&gt; 404
</span><span data-line="15">    |       |-- InvalidTransitionError -&gt; 409
</span><span data-line="16">    |       +-- TaskNotAssignedError -&gt; 403
</span><span data-line="17">    |
</span><span data-line="18">    +-- _configure_openapi()
</span><span data-line="19">            |-- Add workflow tags
</span><span data-line="20">            +-- Register schema components
</span></pre></div>
</div>
</section>
<section id="route-structure">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Route Structure</a><a class="headerlink" href="#route-structure" title="Link to this heading">¶</a></h3>
<p>The plugin creates the following route structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">{path_prefix}/                              # Configured prefix (default: /workflows)
</span><span data-line="2">|
</span><span data-line="3">+-- api/                                    # Public API routes
</span><span data-line="4">|   |-- definitions/                        # Workflow definitions
</span><span data-line="5">|   |   |-- GET     /                       # List definitions
</span><span data-line="6">|   |   |-- GET     /{name}                 # Get definition by name
</span><span data-line="7">|   |   +-- GET     /{name}/versions        # List versions
</span><span data-line="8">|   |
</span><span data-line="9">|   |-- instances/                          # Workflow instances
</span><span data-line="10">|   |   |-- POST    /                       # Start new instance
</span><span data-line="11">|   |   |-- GET     /                       # List instances (paginated)
</span><span data-line="12">|   |   |-- GET     /{instance_id}          # Get instance detail
</span><span data-line="13">|   |   |-- POST    /{instance_id}/cancel   # Cancel instance
</span><span data-line="14">|   |   |-- POST    /{instance_id}/retry    # Retry failed instance
</span><span data-line="15">|   |   +-- GET     /{instance_id}/history  # Get step history
</span><span data-line="16">|   |
</span><span data-line="17">|   +-- tasks/                              # Human tasks
</span><span data-line="18">|       |-- GET     /                       # List my tasks
</span><span data-line="19">|       |-- GET     /{task_id}              # Get task detail
</span><span data-line="20">|       |-- POST    /{task_id}/complete     # Complete task
</span><span data-line="21">|       |-- POST    /{task_id}/claim        # Claim unassigned task
</span><span data-line="22">|       +-- POST    /{task_id}/reassign     # Reassign task
</span><span data-line="23">|
</span><span data-line="24">+-- admin/                                  # Admin API routes
</span><span data-line="25">|   |-- GET     /stats                      # Workflow statistics
</span><span data-line="26">|   |-- GET     /instances                  # All instances (admin view)
</span><span data-line="27">|   |-- POST    /definitions                # Register new definition
</span><span data-line="28">|   |-- DELETE  /definitions/{name}/{ver}   # Deactivate definition
</span><span data-line="29">|   +-- POST    /instances/{id}/force-complete  # Force complete stuck workflow
</span><span data-line="30">|
</span><span data-line="31">+-- graphs/                                 # Graph visualization routes
</span><span data-line="32">    |-- GET     /definitions/{name}         # Definition graph (Mermaid)
</span><span data-line="33">    |-- GET     /instances/{id}             # Instance graph with state
</span><span data-line="34">    +-- GET     /instances/{id}/history     # Animated execution history
</span></pre></div>
</div>
</section>
</section>
<section id="controller-hierarchy">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Controller Hierarchy</a><a class="headerlink" href="#controller-hierarchy" title="Link to this heading">¶</a></h2>
<section id="base-controller">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Base Controller</a><a class="headerlink" href="#base-controller" title="Link to this heading">¶</a></h3>
<p>All workflow controllers inherit from a base class that provides common functionality:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="5">    <span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.engine.registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowRegistry</span>
</span><span data-line="6">    <span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentExecutionEngine</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">class</span><span class="w"> </span><span class="nc">BaseWorkflowController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base controller for workflow endpoints.</span>
</span><span data-line="10">
</span><span data-line="11"><span class="sd">    Provides common dependencies and helper methods for all workflow controllers.</span>
</span><span data-line="12"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="c1"># Injected dependencies (configured via plugin)</span>
</span><span data-line="15">    <span class="n">engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span>
</span><span data-line="16">    <span class="n">registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_user_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="19"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract user ID from request.</span>
</span><span data-line="20">
</span><span data-line="21"><span class="sd">        Override this method to customize user extraction logic.</span>
</span><span data-line="22"><span class="sd">        Default implementation checks request.user.id.</span>
</span><span data-line="23"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="24">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="25">            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="26">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_tenant_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="29"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract tenant ID from request.</span>
</span><span data-line="30">
</span><span data-line="31"><span class="sd">        Override this method for multi-tenant applications.</span>
</span><span data-line="32"><span class="sd">        Default implementation checks request.state.tenant_id.</span>
</span><span data-line="33"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="34">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;tenant_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="workflowdefinitioncontroller">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">WorkflowDefinitionController</a><a class="headerlink" href="#workflowdefinitioncontroller" title="Link to this heading">¶</a></h3>
<p>Controller for workflow definition management:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowDefinitionController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;API for workflow definitions.</span>
</span><span data-line="6">
</span><span data-line="7"><span class="sd">    Provides endpoints for listing and retrieving workflow definitions</span>
</span><span data-line="8"><span class="sd">    registered with the workflow registry.</span>
</span><span data-line="9"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/definitions&quot;</span>
</span><span data-line="12">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Workflow Definitions&quot;</span><span class="p">]</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="15">        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;List workflow definitions&quot;</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns all registered workflow definitions.&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="p">)</span>
</span><span data-line="19">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_definitions</span><span class="p">(</span>
</span><span data-line="20">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="21">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="22">        <span class="n">active_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Filter to active definitions only&quot;</span><span class="p">),</span>
</span><span data-line="23">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowDefinitionDTO</span><span class="p">]:</span>
</span><span data-line="24"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all registered workflow definitions.&quot;&quot;&quot;</span>
</span><span data-line="25">        <span class="o">...</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="28">        <span class="s2">&quot;/{name:str}&quot;</span><span class="p">,</span>
</span><span data-line="29">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Get workflow definition&quot;</span><span class="p">,</span>
</span><span data-line="30">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns a specific workflow definition by name.&quot;</span><span class="p">,</span>
</span><span data-line="31">    <span class="p">)</span>
</span><span data-line="32">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_definition</span><span class="p">(</span>
</span><span data-line="33">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="34">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="35">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="36">        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Specific version to retrieve&quot;</span><span class="p">),</span>
</span><span data-line="37">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowDefinitionDetailDTO</span><span class="p">:</span>
</span><span data-line="38"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific workflow definition.&quot;&quot;&quot;</span>
</span><span data-line="39">        <span class="o">...</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="42">        <span class="s2">&quot;/{name:str}/versions&quot;</span><span class="p">,</span>
</span><span data-line="43">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;List definition versions&quot;</span><span class="p">,</span>
</span><span data-line="44">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns all versions of a workflow definition.&quot;</span><span class="p">,</span>
</span><span data-line="45">    <span class="p">)</span>
</span><span data-line="46">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_versions</span><span class="p">(</span>
</span><span data-line="47">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="48">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="49">        <span class="n">workflow_definition_repo</span><span class="p">:</span> <span class="n">WorkflowDefinitionRepository</span><span class="p">,</span>
</span><span data-line="50">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowDefinitionVersionDTO</span><span class="p">]:</span>
</span><span data-line="51"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all versions of a workflow definition.&quot;&quot;&quot;</span>
</span><span data-line="52">        <span class="o">...</span>
</span></pre></div>
</div>
</section>
<section id="workflowinstancecontroller">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">WorkflowInstanceController</a><a class="headerlink" href="#workflowinstancecontroller" title="Link to this heading">¶</a></h3>
<p>Controller for workflow instance management:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInstanceController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;API for workflow instances.</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">    Provides endpoints for starting, monitoring, and controlling</span>
</span><span data-line="9"><span class="sd">    workflow executions.</span>
</span><span data-line="10"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/instances&quot;</span>
</span><span data-line="13">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Workflow Instances&quot;</span><span class="p">]</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="16">        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Start workflow&quot;</span><span class="p">,</span>
</span><span data-line="18">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Starts a new workflow instance.&quot;</span><span class="p">,</span>
</span><span data-line="19">        <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">,</span>
</span><span data-line="20">    <span class="p">)</span>
</span><span data-line="21">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_workflow</span><span class="p">(</span>
</span><span data-line="22">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="23">        <span class="n">data</span><span class="p">:</span> <span class="n">StartWorkflowDTO</span><span class="p">,</span>
</span><span data-line="24">        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="25">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="26">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="27">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceDTO</span><span class="p">:</span>
</span><span data-line="28"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start a new workflow instance.&quot;&quot;&quot;</span>
</span><span data-line="29">        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_id</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="30">        <span class="n">tenant_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tenant_id</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32">        <span class="n">workflow_class</span> <span class="o">=</span> <span class="n">workflow_registry</span><span class="o">.</span><span class="n">get_workflow_class</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">)</span>
</span><span data-line="33">        <span class="n">instance</span> <span class="o">=</span> <span class="k">await</span> <span class="n">workflow_engine</span><span class="o">.</span><span class="n">start_workflow</span><span class="p">(</span>
</span><span data-line="34">            <span class="n">workflow_class</span><span class="p">,</span>
</span><span data-line="35">            <span class="n">initial_data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">initial_data</span><span class="p">,</span>
</span><span data-line="36">            <span class="n">tenant_id</span><span class="o">=</span><span class="n">tenant_id</span><span class="p">,</span>
</span><span data-line="37">            <span class="n">created_by</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span data-line="38">        <span class="p">)</span>
</span><span data-line="39">        <span class="k">return</span> <span class="n">WorkflowInstanceDTO</span><span class="o">.</span><span class="n">from_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="42">        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span data-line="43">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;List workflow instances&quot;</span><span class="p">,</span>
</span><span data-line="44">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns paginated list of workflow instances.&quot;</span><span class="p">,</span>
</span><span data-line="45">    <span class="p">)</span>
</span><span data-line="46">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_instances</span><span class="p">(</span>
</span><span data-line="47">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="48">        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="49">        <span class="n">workflow_instance_repo</span><span class="p">:</span> <span class="n">WorkflowInstanceRepository</span><span class="p">,</span>
</span><span data-line="50">        <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="51">        <span class="n">status</span><span class="p">:</span> <span class="n">WorkflowStatus</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="52">        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span data-line="53">        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span data-line="54">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">WorkflowInstanceDTO</span><span class="p">]:</span>
</span><span data-line="55"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List workflow instances with filtering and pagination.&quot;&quot;&quot;</span>
</span><span data-line="56">        <span class="o">...</span>
</span><span data-line="57">
</span><span data-line="58">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="59">        <span class="s2">&quot;/{instance_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="60">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Get workflow instance&quot;</span><span class="p">,</span>
</span><span data-line="61">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns detailed information about a workflow instance.&quot;</span><span class="p">,</span>
</span><span data-line="62">    <span class="p">)</span>
</span><span data-line="63">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_instance</span><span class="p">(</span>
</span><span data-line="64">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="65">        <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="66">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="67">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceDetailDTO</span><span class="p">:</span>
</span><span data-line="68"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed workflow instance information.&quot;&quot;&quot;</span>
</span><span data-line="69">        <span class="o">...</span>
</span><span data-line="70">
</span><span data-line="71">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="72">        <span class="s2">&quot;/{instance_id:uuid}/cancel&quot;</span><span class="p">,</span>
</span><span data-line="73">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Cancel workflow&quot;</span><span class="p">,</span>
</span><span data-line="74">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cancels a running workflow instance.&quot;</span><span class="p">,</span>
</span><span data-line="75">    <span class="p">)</span>
</span><span data-line="76">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cancel_instance</span><span class="p">(</span>
</span><span data-line="77">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="78">        <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="79">        <span class="n">data</span><span class="p">:</span> <span class="n">CancelWorkflowDTO</span><span class="p">,</span>
</span><span data-line="80">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="81">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceDTO</span><span class="p">:</span>
</span><span data-line="82"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel a running workflow instance.&quot;&quot;&quot;</span>
</span><span data-line="83">        <span class="o">...</span>
</span><span data-line="84">
</span><span data-line="85">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="86">        <span class="s2">&quot;/{instance_id:uuid}/retry&quot;</span><span class="p">,</span>
</span><span data-line="87">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Retry workflow&quot;</span><span class="p">,</span>
</span><span data-line="88">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Retries a failed workflow from the failed step.&quot;</span><span class="p">,</span>
</span><span data-line="89">    <span class="p">)</span>
</span><span data-line="90">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retry_instance</span><span class="p">(</span>
</span><span data-line="91">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="92">        <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="93">        <span class="n">data</span><span class="p">:</span> <span class="n">RetryWorkflowDTO</span><span class="p">,</span>
</span><span data-line="94">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="95">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceDTO</span><span class="p">:</span>
</span><span data-line="96"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retry a failed workflow from a specific step.&quot;&quot;&quot;</span>
</span><span data-line="97">        <span class="o">...</span>
</span></pre></div>
</div>
</section>
<section id="humantaskcontroller">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">HumanTaskController</a><a class="headerlink" href="#humantaskcontroller" title="Link to this heading">¶</a></h3>
<p>Controller for human task management:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">class</span><span class="w"> </span><span class="nc">HumanTaskController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;API for human tasks.</span>
</span><span data-line="6">
</span><span data-line="7"><span class="sd">    Provides endpoints for listing, claiming, and completing</span>
</span><span data-line="8"><span class="sd">    human approval tasks in workflows.</span>
</span><span data-line="9"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/tasks&quot;</span>
</span><span data-line="12">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Human Tasks&quot;</span><span class="p">]</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="15">        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;List my tasks&quot;</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns pending tasks assigned to the current user.&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="p">)</span>
</span><span data-line="19">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_my_tasks</span><span class="p">(</span>
</span><span data-line="20">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="21">        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="22">        <span class="n">workflow_task_repo</span><span class="p">:</span> <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="23">        <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;pending&quot;</span><span class="p">),</span>
</span><span data-line="24">        <span class="n">assignee_group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="25">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">HumanTaskDTO</span><span class="p">]:</span>
</span><span data-line="26"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List human tasks assigned to current user.&quot;&quot;&quot;</span>
</span><span data-line="27">        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_id</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="28">        <span class="n">tasks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">workflow_task_repo</span><span class="o">.</span><span class="n">find_pending</span><span class="p">(</span>
</span><span data-line="29">            <span class="n">assignee_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span data-line="30">            <span class="n">assignee_group</span><span class="o">=</span><span class="n">assignee_group</span><span class="p">,</span>
</span><span data-line="31">        <span class="p">)</span>
</span><span data-line="32">        <span class="k">return</span> <span class="p">[</span><span class="n">HumanTaskDTO</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
</span><span data-line="33">
</span><span data-line="34">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="35">        <span class="s2">&quot;/{task_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="36">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Get task detail&quot;</span><span class="p">,</span>
</span><span data-line="37">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns detailed task information including form schema.&quot;</span><span class="p">,</span>
</span><span data-line="38">    <span class="p">)</span>
</span><span data-line="39">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_task</span><span class="p">(</span>
</span><span data-line="40">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="41">        <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="42">        <span class="n">workflow_task_repo</span><span class="p">:</span> <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="43">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HumanTaskDetailDTO</span><span class="p">:</span>
</span><span data-line="44"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get human task details including form schema.&quot;&quot;&quot;</span>
</span><span data-line="45">        <span class="o">...</span>
</span><span data-line="46">
</span><span data-line="47">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="48">        <span class="s2">&quot;/{task_id:uuid}/complete&quot;</span><span class="p">,</span>
</span><span data-line="49">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Complete task&quot;</span><span class="p">,</span>
</span><span data-line="50">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Completes a human task with form data.&quot;</span><span class="p">,</span>
</span><span data-line="51">    <span class="p">)</span>
</span><span data-line="52">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">complete_task</span><span class="p">(</span>
</span><span data-line="53">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="54">        <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="55">        <span class="n">data</span><span class="p">:</span> <span class="n">CompleteTaskDTO</span><span class="p">,</span>
</span><span data-line="56">        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="57">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="58">        <span class="n">workflow_task_repo</span><span class="p">:</span> <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="59">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceDTO</span><span class="p">:</span>
</span><span data-line="60"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Complete a human task with form data.&quot;&quot;&quot;</span>
</span><span data-line="61">        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_id</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="62">        <span class="n">task</span> <span class="o">=</span> <span class="k">await</span> <span class="n">workflow_task_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span data-line="63">
</span><span data-line="64">        <span class="c1"># Validate task ownership</span>
</span><span data-line="65">        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">assignee_id</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">assignee_id</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
</span><span data-line="66">            <span class="k">raise</span> <span class="n">TaskNotAssignedError</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span data-line="67">
</span><span data-line="68">        <span class="k">await</span> <span class="n">workflow_engine</span><span class="o">.</span><span class="n">complete_human_task</span><span class="p">(</span>
</span><span data-line="69">            <span class="n">instance_id</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">instance_id</span><span class="p">,</span>
</span><span data-line="70">            <span class="n">step_name</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">step_name</span><span class="p">,</span>
</span><span data-line="71">            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span data-line="72">            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">form_data</span><span class="p">,</span>
</span><span data-line="73">        <span class="p">)</span>
</span><span data-line="74">        <span class="o">...</span>
</span><span data-line="75">
</span><span data-line="76">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="77">        <span class="s2">&quot;/{task_id:uuid}/claim&quot;</span><span class="p">,</span>
</span><span data-line="78">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Claim task&quot;</span><span class="p">,</span>
</span><span data-line="79">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Claims an unassigned task for the current user.&quot;</span><span class="p">,</span>
</span><span data-line="80">    <span class="p">)</span>
</span><span data-line="81">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">claim_task</span><span class="p">(</span>
</span><span data-line="82">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="83">        <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="84">        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="85">        <span class="n">workflow_task_repo</span><span class="p">:</span> <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="86">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HumanTaskDTO</span><span class="p">:</span>
</span><span data-line="87"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Claim an unassigned task.&quot;&quot;&quot;</span>
</span><span data-line="88">        <span class="o">...</span>
</span><span data-line="89">
</span><span data-line="90">    <span class="nd">@post</span><span class="p">(</span>
</span><span data-line="91">        <span class="s2">&quot;/{task_id:uuid}/reassign&quot;</span><span class="p">,</span>
</span><span data-line="92">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Reassign task&quot;</span><span class="p">,</span>
</span><span data-line="93">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reassigns a task to another user.&quot;</span><span class="p">,</span>
</span><span data-line="94">    <span class="p">)</span>
</span><span data-line="95">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reassign_task</span><span class="p">(</span>
</span><span data-line="96">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="97">        <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="98">        <span class="n">data</span><span class="p">:</span> <span class="n">ReassignTaskDTO</span><span class="p">,</span>
</span><span data-line="99">        <span class="n">workflow_task_repo</span><span class="p">:</span> <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="100">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HumanTaskDTO</span><span class="p">:</span>
</span><span data-line="101"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reassign task to another user.&quot;&quot;&quot;</span>
</span><span data-line="102">        <span class="o">...</span>
</span></pre></div>
</div>
</section>
</section>
<section id="dto-layer-design">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">DTO Layer Design</a><a class="headerlink" href="#dto-layer-design" title="Link to this heading">¶</a></h2>
<section id="dto-architecture">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">DTO Architecture</a><a class="headerlink" href="#dto-architecture" title="Link to this heading">¶</a></h3>
<p>The DTO layer uses <code class="docutils literal notranslate"><span class="pre">msgspec.Struct</span></code> for high-performance serialization with
validation. DTOs are organized by domain and follow a consistent naming pattern:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*DTO</span></code>: Base response/request DTO</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*DetailDTO</span></code>: Extended DTO with additional fields</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Create*DTO</span></code>: Input DTO for creation operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Update*DTO</span></code>: Input DTO for update operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*ListDTO</span></code>: Paginated list response wrapper</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">msgspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Struct</span><span class="p">,</span> <span class="n">field</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">class</span><span class="w"> </span><span class="nc">PaginatedResponse</span><span class="p">(</span><span class="n">Struct</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic paginated response wrapper.&quot;&quot;&quot;</span>
</span><span data-line="10">    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span data-line="11">    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="12">    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="13">    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="14">    <span class="n">has_more</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="request-dtos">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Request DTOs</a><a class="headerlink" href="#request-dtos" title="Link to this heading">¶</a></h3>
<p>Input DTOs for API operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">msgspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Struct</span><span class="p">,</span> <span class="n">field</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">class</span><span class="w"> </span><span class="nc">StartWorkflowDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for starting a workflow instance.</span>
</span><span data-line="6">
</span><span data-line="7"><span class="sd">    Attributes:</span>
</span><span data-line="8"><span class="sd">        workflow_name: Name of the workflow to start.</span>
</span><span data-line="9"><span class="sd">        initial_data: Optional initial context data.</span>
</span><span data-line="10"><span class="sd">        metadata: Optional metadata to attach to the instance.</span>
</span><span data-line="11"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="12">    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="13">    <span class="n">initial_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="14">    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="15">
</span><span data-line="16"><span class="k">class</span><span class="w"> </span><span class="nc">CancelWorkflowDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="17"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for canceling a workflow instance.&quot;&quot;&quot;</span>
</span><span data-line="18">    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="k">class</span><span class="w"> </span><span class="nc">RetryWorkflowDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="21"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for retrying a failed workflow.&quot;&quot;&quot;</span>
</span><span data-line="22">    <span class="n">from_step</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># If None, retry from failed step</span>
</span><span data-line="23">    <span class="n">clear_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="24">
</span><span data-line="25"><span class="k">class</span><span class="w"> </span><span class="nc">CompleteTaskDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="26"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for completing a human task.&quot;&quot;&quot;</span>
</span><span data-line="27">    <span class="n">form_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span data-line="28">    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="29">
</span><span data-line="30"><span class="k">class</span><span class="w"> </span><span class="nc">ReassignTaskDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="31"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for reassigning a human task.&quot;&quot;&quot;</span>
</span><span data-line="32">    <span class="n">assignee_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="33">    <span class="n">assignee_group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="34">    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
<section id="response-dtos">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Response DTOs</a><a class="headerlink" href="#response-dtos" title="Link to this heading">¶</a></h3>
<p>Output DTOs for API responses:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">msgspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Struct</span><span class="p">,</span> <span class="n">field</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowDefinitionDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for workflow definition summary.&quot;&quot;&quot;</span>
</span><span data-line="7">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="8">    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="9">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="10">    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span>
</span><span data-line="11">    <span class="n">step_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="12">    <span class="n">initial_step</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="13">    <span class="n">terminal_steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="14">
</span><span data-line="15"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowDefinitionDetailDTO</span><span class="p">(</span><span class="n">WorkflowDefinitionDTO</span><span class="p">):</span>
</span><span data-line="16"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for detailed workflow definition.&quot;&quot;&quot;</span>
</span><span data-line="17">    <span class="n">steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StepDTO</span><span class="p">]</span>
</span><span data-line="18">    <span class="n">edges</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">EdgeDTO</span><span class="p">]</span>
</span><span data-line="19">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="20">    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="21">
</span><span data-line="22"><span class="k">class</span><span class="w"> </span><span class="nc">StepDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="23"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for workflow step.&quot;&quot;&quot;</span>
</span><span data-line="24">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="25">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="26">    <span class="n">step_type</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="27">    <span class="n">is_initial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="28">    <span class="n">is_terminal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="29">
</span><span data-line="30"><span class="k">class</span><span class="w"> </span><span class="nc">EdgeDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="31"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for workflow edge.&quot;&quot;&quot;</span>
</span><span data-line="32">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="33">    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="34">    <span class="n">condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="35">
</span><span data-line="36"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInstanceDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="37"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for workflow instance summary.&quot;&quot;&quot;</span>
</span><span data-line="38">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="39">    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="40">    <span class="n">workflow_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="41">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="42">    <span class="n">current_step</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="43">    <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="44">    <span class="n">completed_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="45">
</span><span data-line="46"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInstanceDetailDTO</span><span class="p">(</span><span class="n">WorkflowInstanceDTO</span><span class="p">):</span>
</span><span data-line="47"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for detailed workflow instance.&quot;&quot;&quot;</span>
</span><span data-line="48">    <span class="n">context_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span data-line="49">    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span data-line="50">    <span class="n">step_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StepExecutionDTO</span><span class="p">]</span>
</span><span data-line="51">    <span class="n">error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="52">    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="53">    <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="54">
</span><span data-line="55"><span class="k">class</span><span class="w"> </span><span class="nc">StepExecutionDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="56"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for step execution record.&quot;&quot;&quot;</span>
</span><span data-line="57">    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="58">    <span class="n">step_type</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="59">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="60">    <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="61">    <span class="n">completed_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="62">    <span class="n">output_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="63">    <span class="n">error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="64">
</span><span data-line="65"><span class="k">class</span><span class="w"> </span><span class="nc">HumanTaskDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="66"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for human task summary.&quot;&quot;&quot;</span>
</span><span data-line="67">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="68">    <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="69">    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="70">    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="71">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="72">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="73">    <span class="n">assignee_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="74">    <span class="n">assignee_group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="75">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="76">    <span class="n">due_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="77">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="78">
</span><span data-line="79"><span class="k">class</span><span class="w"> </span><span class="nc">HumanTaskDetailDTO</span><span class="p">(</span><span class="n">HumanTaskDTO</span><span class="p">):</span>
</span><span data-line="80"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for detailed human task.&quot;&quot;&quot;</span>
</span><span data-line="81">    <span class="n">form_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="82">    <span class="n">workflow_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span data-line="83">    <span class="n">step_execution_id</span><span class="p">:</span> <span class="n">UUID</span>
</span></pre></div>
</div>
</section>
<section id="validation-strategy">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Validation Strategy</a><a class="headerlink" href="#validation-strategy" title="Link to this heading">¶</a></h3>
<p>DTOs implement validation through <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> constraints and custom validators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">msgspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Struct</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">ValidationError</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">class</span><span class="w"> </span><span class="nc">StartWorkflowDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO with validation constraints.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="n">workflow_name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)]</span>
</span><span data-line="7">    <span class="n">initial_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="10"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Additional validation after initialization.&quot;&quot;&quot;</span>
</span><span data-line="11">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_data</span><span class="p">:</span>
</span><span data-line="12">            <span class="c1"># Validate initial_data doesn&#39;t exceed size limit</span>
</span><span data-line="13">            <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span data-line="14">            <span class="n">data_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_data</span><span class="p">))</span>
</span><span data-line="15">            <span class="k">if</span> <span class="n">data_size</span> <span class="o">&gt;</span> <span class="mi">1_000_000</span><span class="p">:</span>  <span class="c1"># 1MB limit</span>
</span><span data-line="16">                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;initial_data exceeds maximum size of 1MB&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Custom validation decorators for complex rules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationException</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">def</span><span class="w"> </span><span class="nf">validate_workflow_exists</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to validate workflow exists before operation.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span data-line="7">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span>
</span><span data-line="8">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="11">        <span class="o">**</span><span class="n">kwargs</span>
</span><span data-line="12">    <span class="p">):</span>
</span><span data-line="13">        <span class="k">if</span> <span class="ow">not</span> <span class="n">workflow_registry</span><span class="o">.</span><span class="n">has_definition</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">):</span>
</span><span data-line="14">            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
</span><span data-line="15">                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span data-line="16">            <span class="p">)</span>
</span><span data-line="17">        <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">workflow_registry</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="18">    <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>
</div>
</section>
</section>
<section id="openapi-integration">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">OpenAPI Integration</a><a class="headerlink" href="#openapi-integration" title="Link to this heading">¶</a></h2>
<section id="schema-configuration">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Schema Configuration</a><a class="headerlink" href="#schema-configuration" title="Link to this heading">¶</a></h3>
<p>The plugin configures OpenAPI schema generation with comprehensive documentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.openapi.spec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">ExternalDocumentation</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">WORKFLOW_OPENAPI_TAGS</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4">    <span class="n">Tag</span><span class="p">(</span>
</span><span data-line="5">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Workflow Definitions&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoints for managing workflow definitions and schemas.&quot;</span><span class="p">,</span>
</span><span data-line="7">        <span class="n">external_docs</span><span class="o">=</span><span class="n">ExternalDocumentation</span><span class="p">(</span>
</span><span data-line="8">            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://docs.litestar-workflows.dev/concepts/workflows&quot;</span><span class="p">,</span>
</span><span data-line="9">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Workflow Concepts Guide&quot;</span><span class="p">,</span>
</span><span data-line="10">        <span class="p">),</span>
</span><span data-line="11">    <span class="p">),</span>
</span><span data-line="12">    <span class="n">Tag</span><span class="p">(</span>
</span><span data-line="13">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Workflow Instances&quot;</span><span class="p">,</span>
</span><span data-line="14">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoints for starting, monitoring, and controlling workflow executions.&quot;</span><span class="p">,</span>
</span><span data-line="15">        <span class="n">external_docs</span><span class="o">=</span><span class="n">ExternalDocumentation</span><span class="p">(</span>
</span><span data-line="16">            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://docs.litestar-workflows.dev/guides/execution&quot;</span><span class="p">,</span>
</span><span data-line="17">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Execution Guide&quot;</span><span class="p">,</span>
</span><span data-line="18">        <span class="p">),</span>
</span><span data-line="19">    <span class="p">),</span>
</span><span data-line="20">    <span class="n">Tag</span><span class="p">(</span>
</span><span data-line="21">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Human Tasks&quot;</span><span class="p">,</span>
</span><span data-line="22">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoints for managing human approval tasks and form submissions.&quot;</span><span class="p">,</span>
</span><span data-line="23">        <span class="n">external_docs</span><span class="o">=</span><span class="n">ExternalDocumentation</span><span class="p">(</span>
</span><span data-line="24">            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://docs.litestar-workflows.dev/guides/human-tasks&quot;</span><span class="p">,</span>
</span><span data-line="25">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Human Tasks Guide&quot;</span><span class="p">,</span>
</span><span data-line="26">        <span class="p">),</span>
</span><span data-line="27">    <span class="p">),</span>
</span><span data-line="28">    <span class="n">Tag</span><span class="p">(</span>
</span><span data-line="29">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Workflow Admin&quot;</span><span class="p">,</span>
</span><span data-line="30">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Administrative endpoints for workflow management (requires admin privileges).&quot;</span><span class="p">,</span>
</span><span data-line="31">    <span class="p">),</span>
</span><span data-line="32">    <span class="n">Tag</span><span class="p">(</span>
</span><span data-line="33">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Workflow Graphs&quot;</span><span class="p">,</span>
</span><span data-line="34">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoints for workflow visualization using MermaidJS.&quot;</span><span class="p">,</span>
</span><span data-line="35">    <span class="p">),</span>
</span><span data-line="36"><span class="p">]</span>
</span><span data-line="37">
</span><span data-line="38"><span class="k">def</span><span class="w"> </span><span class="nf">configure_openapi</span><span class="p">(</span><span class="n">app_config</span><span class="p">:</span> <span class="n">AppConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="39"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure OpenAPI schema for workflow endpoints.&quot;&quot;&quot;</span>
</span><span data-line="40">    <span class="k">if</span> <span class="n">app_config</span><span class="o">.</span><span class="n">openapi_config</span><span class="p">:</span>
</span><span data-line="41">        <span class="n">existing_tags</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">openapi_config</span><span class="o">.</span><span class="n">tags</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="42">        <span class="n">app_config</span><span class="o">.</span><span class="n">openapi_config</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">existing_tags</span><span class="p">,</span> <span class="o">*</span><span class="n">WORKFLOW_OPENAPI_TAGS</span><span class="p">]</span>
</span></pre></div>
</div>
</section>
<section id="response-examples">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Response Examples</a><a class="headerlink" href="#response-examples" title="Link to this heading">¶</a></h3>
<p>DTOs include OpenAPI examples for documentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.openapi.spec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Example</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInstanceDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="4"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO with OpenAPI examples.&quot;&quot;&quot;</span>
</span><span data-line="5">
</span><span data-line="6">    <span class="n">__openapi_examples__</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="7">        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="n">Example</span><span class="p">(</span>
</span><span data-line="8">            <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Running Instance&quot;</span><span class="p">,</span>
</span><span data-line="9">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A workflow instance currently executing&quot;</span><span class="p">,</span>
</span><span data-line="10">            <span class="n">value</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="11">                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
</span><span data-line="12">                <span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="s2">&quot;document_approval&quot;</span><span class="p">,</span>
</span><span data-line="13">                <span class="s2">&quot;workflow_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span data-line="14">                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span><span class="p">,</span>
</span><span data-line="15">                <span class="s2">&quot;current_step&quot;</span><span class="p">:</span> <span class="s2">&quot;manager_review&quot;</span><span class="p">,</span>
</span><span data-line="16">                <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-24T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="17">                <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="18">            <span class="p">},</span>
</span><span data-line="19">        <span class="p">),</span>
</span><span data-line="20">        <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="n">Example</span><span class="p">(</span>
</span><span data-line="21">            <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Completed Instance&quot;</span><span class="p">,</span>
</span><span data-line="22">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A successfully completed workflow instance&quot;</span><span class="p">,</span>
</span><span data-line="23">            <span class="n">value</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="24">                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;550e8400-e29b-41d4-a716-446655440001&quot;</span><span class="p">,</span>
</span><span data-line="25">                <span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="s2">&quot;document_approval&quot;</span><span class="p">,</span>
</span><span data-line="26">                <span class="s2">&quot;workflow_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span data-line="27">                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
</span><span data-line="28">                <span class="s2">&quot;current_step&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="29">                <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-24T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="30">                <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-24T11:45:00Z&quot;</span><span class="p">,</span>
</span><span data-line="31">            <span class="p">},</span>
</span><span data-line="32">        <span class="p">),</span>
</span><span data-line="33">    <span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="guard-integration-patterns">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">Guard Integration Patterns</a><a class="headerlink" href="#guard-integration-patterns" title="Link to this heading">¶</a></h2>
<section id="base-guard-protocol">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Base Guard Protocol</a><a class="headerlink" href="#base-guard-protocol" title="Link to this heading">¶</a></h3>
<p>Guards follow a consistent protocol for workflow authorization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.handlers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRouteHandler</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotAuthorizedException</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">BaseWorkflowGuard</span><span class="p">:</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base protocol for workflow guards.</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">    All workflow guards should implement this interface for consistent</span>
</span><span data-line="9"><span class="sd">    authorization behavior across the API.</span>
</span><span data-line="10"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="13">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="14">        <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="15">        <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="16">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="17"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check authorization for the request.</span>
</span><span data-line="18">
</span><span data-line="19"><span class="sd">        Args:</span>
</span><span data-line="20"><span class="sd">            connection: The ASGI connection.</span>
</span><span data-line="21"><span class="sd">            route_handler: The route handler being accessed.</span>
</span><span data-line="22">
</span><span data-line="23"><span class="sd">        Raises:</span>
</span><span data-line="24"><span class="sd">            NotAuthorizedException: If authorization fails.</span>
</span><span data-line="25"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="26">        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>
</div>
</section>
<section id="authentication-guard">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Authentication Guard</a><a class="headerlink" href="#authentication-guard" title="Link to this heading">¶</a></h3>
<p>Guard requiring authenticated user:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowAuthGuard</span><span class="p">(</span><span class="n">BaseWorkflowGuard</span><span class="p">):</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Guard requiring authenticated user for workflow operations.&quot;&quot;&quot;</span>
</span><span data-line="3">
</span><span data-line="4">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="5">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="7">        <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="8">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="9">        <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="10">            <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span>
</span><span data-line="11">                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Authentication required for workflow operations&quot;</span>
</span><span data-line="12">            <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="admin-guard">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Admin Guard</a><a class="headerlink" href="#admin-guard" title="Link to this heading">¶</a></h3>
<p>Guard requiring admin privileges:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowAdminGuard</span><span class="p">(</span><span class="n">BaseWorkflowGuard</span><span class="p">):</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Guard requiring admin role for administrative operations.&quot;&quot;&quot;</span>
</span><span data-line="3">
</span><span data-line="4">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_admin&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5">        <span class="bp">self</span><span class="o">.</span><span class="n">admin_role</span> <span class="o">=</span> <span class="n">admin_role</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="8">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="11">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="12">        <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="13">            <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15">        <span class="n">roles</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;roles&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span data-line="16">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
</span><span data-line="17">            <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span>
</span><span data-line="18">                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Role &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_role</span><span class="si">}</span><span class="s2">&#39; required for admin operations&quot;</span>
</span><span data-line="19">            <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="task-ownership-guard">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Task Ownership Guard</a><a class="headerlink" href="#task-ownership-guard" title="Link to this heading">¶</a></h3>
<p>Guard validating task assignment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">TaskAssigneeGuard</span><span class="p">(</span><span class="n">BaseWorkflowGuard</span><span class="p">):</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Guard ensuring user is assigned to the task.</span>
</span><span data-line="3">
</span><span data-line="4"><span class="sd">    This guard validates that the current user is either:</span>
</span><span data-line="5"><span class="sd">    - Directly assigned to the task (assignee_id matches)</span>
</span><span data-line="6"><span class="sd">    - Member of the assigned group (assignee_group matches user&#39;s groups)</span>
</span><span data-line="7"><span class="sd">    - An admin (bypasses ownership check)</span>
</span><span data-line="8"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="11">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="12">        <span class="n">allow_unassigned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="13">        <span class="n">admin_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_admin&quot;</span><span class="p">,</span>
</span><span data-line="14">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="15">        <span class="bp">self</span><span class="o">.</span><span class="n">allow_unassigned</span> <span class="o">=</span> <span class="n">allow_unassigned</span>
</span><span data-line="16">        <span class="bp">self</span><span class="o">.</span><span class="n">admin_role</span> <span class="o">=</span> <span class="n">admin_role</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="19">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="20">        <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="21">        <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="22">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="23">        <span class="c1"># Extract task_id from path</span>
</span><span data-line="24">        <span class="n">task_id</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">path_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_id&quot;</span><span class="p">)</span>
</span><span data-line="25">        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_id</span><span class="p">:</span>
</span><span data-line="26">            <span class="k">return</span>  <span class="c1"># Not a task-specific route</span>
</span><span data-line="27">
</span><span data-line="28">        <span class="c1"># Get task from database</span>
</span><span data-line="29">        <span class="n">task_repo</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">task_repo</span>
</span><span data-line="30">        <span class="n">task</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32">        <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="p">:</span>
</span><span data-line="33">            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35">        <span class="n">user_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="36">        <span class="n">user_groups</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span data-line="37">        <span class="n">user_roles</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;roles&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span data-line="38">
</span><span data-line="39">        <span class="c1"># Admin bypass</span>
</span><span data-line="40">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_role</span> <span class="ow">in</span> <span class="n">user_roles</span><span class="p">:</span>
</span><span data-line="41">            <span class="k">return</span>
</span><span data-line="42">
</span><span data-line="43">        <span class="c1"># Check assignment</span>
</span><span data-line="44">        <span class="n">is_assigned</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="45">            <span class="n">task</span><span class="o">.</span><span class="n">assignee_id</span> <span class="o">==</span> <span class="n">user_id</span>
</span><span data-line="46">            <span class="ow">or</span> <span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">assignee_group</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">assignee_group</span> <span class="ow">in</span> <span class="n">user_groups</span><span class="p">)</span>
</span><span data-line="47">            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_unassigned</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">assignee_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">assignee_group</span><span class="p">)</span>
</span><span data-line="48">        <span class="p">)</span>
</span><span data-line="49">
</span><span data-line="50">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_assigned</span><span class="p">:</span>
</span><span data-line="51">            <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span>
</span><span data-line="52">                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;You are not assigned to this task&quot;</span>
</span><span data-line="53">            <span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="mermaidjs-graph-generation">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">MermaidJS Graph Generation</a><a class="headerlink" href="#mermaidjs-graph-generation" title="Link to this heading">¶</a></h2>
<section id="graph-service">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Graph Service</a><a class="headerlink" href="#graph-service" title="Link to this heading">¶</a></h3>
<p>Service for generating MermaidJS diagrams from workflow definitions and instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.core.definition</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowDefinition</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.core.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">StepType</span><span class="p">,</span> <span class="n">StepStatus</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">class</span><span class="w"> </span><span class="nc">GraphService</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Service for generating workflow visualizations.</span>
</span><span data-line="6">
</span><span data-line="7"><span class="sd">    Generates MermaidJS diagrams for workflow definitions and instances</span>
</span><span data-line="8"><span class="sd">    with support for execution state highlighting.</span>
</span><span data-line="9"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="c1"># MermaidJS shape mappings by step type</span>
</span><span data-line="12">    <span class="n">STEP_SHAPES</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">StepType</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="13">        <span class="n">StepType</span><span class="o">.</span><span class="n">MACHINE</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">),</span>          <span class="c1"># Rectangle</span>
</span><span data-line="14">        <span class="n">StepType</span><span class="o">.</span><span class="n">HUMAN</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;{{&quot;</span><span class="p">,</span> <span class="s2">&quot;}}&quot;</span><span class="p">),</span>          <span class="c1"># Hexagon</span>
</span><span data-line="15">        <span class="n">StepType</span><span class="o">.</span><span class="n">GATEWAY</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;}&quot;</span><span class="p">),</span>          <span class="c1"># Diamond</span>
</span><span data-line="16">        <span class="n">StepType</span><span class="o">.</span><span class="n">TIMER</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;([&quot;</span><span class="p">,</span> <span class="s2">&quot;])&quot;</span><span class="p">),</span>          <span class="c1"># Stadium</span>
</span><span data-line="17">        <span class="n">StepType</span><span class="o">.</span><span class="n">WEBHOOK</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;[[&quot;</span><span class="p">,</span> <span class="s2">&quot;]]&quot;</span><span class="p">),</span>        <span class="c1"># Subroutine</span>
</span><span data-line="18">    <span class="p">}</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="c1"># Status color mappings</span>
</span><span data-line="21">    <span class="n">STATUS_STYLES</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="22">        <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="s2">&quot;fill:#90EE90,stroke:#006400,stroke-width:2px&quot;</span><span class="p">,</span>
</span><span data-line="23">        <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="s2">&quot;fill:#FFB6C1,stroke:#8B0000,stroke-width:2px&quot;</span><span class="p">,</span>
</span><span data-line="24">        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="s2">&quot;fill:#FFD700,stroke:#FFA500,stroke-width:3px&quot;</span><span class="p">,</span>
</span><span data-line="25">        <span class="s2">&quot;waiting&quot;</span><span class="p">:</span> <span class="s2">&quot;fill:#87CEEB,stroke:#4169E1,stroke-width:2px&quot;</span><span class="p">,</span>
</span><span data-line="26">        <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="s2">&quot;fill:#D3D3D3,stroke:#808080,stroke-width:1px,stroke-dasharray:5&quot;</span><span class="p">,</span>
</span><span data-line="27">    <span class="p">}</span>
</span><span data-line="28">
</span><span data-line="29">    <span class="k">def</span><span class="w"> </span><span class="nf">generate_definition_graph</span><span class="p">(</span>
</span><span data-line="30">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="31">        <span class="n">definition</span><span class="p">:</span> <span class="n">WorkflowDefinition</span><span class="p">,</span>
</span><span data-line="32">        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TD&quot;</span><span class="p">,</span>
</span><span data-line="33">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="34"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate MermaidJS graph for a workflow definition.</span>
</span><span data-line="35">
</span><span data-line="36"><span class="sd">        Args:</span>
</span><span data-line="37"><span class="sd">            definition: The workflow definition to visualize.</span>
</span><span data-line="38"><span class="sd">            direction: Graph direction (TD, LR, BT, RL).</span>
</span><span data-line="39">
</span><span data-line="40"><span class="sd">        Returns:</span>
</span><span data-line="41"><span class="sd">            MermaidJS graph definition string.</span>
</span><span data-line="42"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="43">        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;graph </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span data-line="44">
</span><span data-line="45">        <span class="c1"># Add nodes</span>
</span><span data-line="46">        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="47">            <span class="n">shape_start</span><span class="p">,</span> <span class="n">shape_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STEP_SHAPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="48">                <span class="n">step</span><span class="o">.</span><span class="n">step_type</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span><span data-line="49">            <span class="p">)</span>
</span><span data-line="50">
</span><span data-line="51">            <span class="c1"># Format label</span>
</span><span data-line="52">            <span class="n">label</span> <span class="o">=</span> <span class="n">step_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span data-line="53">
</span><span data-line="54">            <span class="c1"># Add markers for special steps</span>
</span><span data-line="55">            <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="n">definition</span><span class="o">.</span><span class="n">initial_step</span><span class="p">:</span>
</span><span data-line="56">                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[Start] </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="57">            <span class="k">elif</span> <span class="n">step_name</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">terminal_steps</span><span class="p">:</span>
</span><span data-line="58">                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> [End]&quot;</span>
</span><span data-line="59">
</span><span data-line="60">            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">step_name</span><span class="si">}{</span><span class="n">shape_start</span><span class="si">}{</span><span class="n">label</span><span class="si">}{</span><span class="n">shape_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="61">
</span><span data-line="62">        <span class="c1"># Add edges</span>
</span><span data-line="63">        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span data-line="64">            <span class="n">source</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get_source_name</span><span class="p">()</span>
</span><span data-line="65">            <span class="n">target</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get_target_name</span><span class="p">()</span>
</span><span data-line="66">
</span><span data-line="67">            <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">condition</span><span class="p">:</span>
</span><span data-line="68">                <span class="c1"># Conditional edge with label</span>
</span><span data-line="69">                <span class="n">condition_label</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="70">                    <span class="n">edge</span><span class="o">.</span><span class="n">condition</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span data-line="71">                    <span class="k">else</span> <span class="s2">&quot;conditional&quot;</span>
</span><span data-line="72">                <span class="p">)</span>
</span><span data-line="73">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> --&gt;|</span><span class="si">{</span><span class="n">condition_label</span><span class="si">}</span><span class="s2">| </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="74">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="75">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="76">
</span><span data-line="77">        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span data-line="78">
</span><span data-line="79">    <span class="k">def</span><span class="w"> </span><span class="nf">generate_instance_graph</span><span class="p">(</span>
</span><span data-line="80">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="81">        <span class="n">definition</span><span class="p">:</span> <span class="n">WorkflowDefinition</span><span class="p">,</span>
</span><span data-line="82">        <span class="n">current_step</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="83">        <span class="n">step_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StepExecutionDTO</span><span class="p">],</span>
</span><span data-line="84">        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TD&quot;</span><span class="p">,</span>
</span><span data-line="85">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="86"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate MermaidJS graph with execution state.</span>
</span><span data-line="87">
</span><span data-line="88"><span class="sd">        Args:</span>
</span><span data-line="89"><span class="sd">            definition: The workflow definition.</span>
</span><span data-line="90"><span class="sd">            current_step: Name of the currently executing step.</span>
</span><span data-line="91"><span class="sd">            step_history: List of executed steps with status.</span>
</span><span data-line="92"><span class="sd">            direction: Graph direction.</span>
</span><span data-line="93">
</span><span data-line="94"><span class="sd">        Returns:</span>
</span><span data-line="95"><span class="sd">            MermaidJS graph with state highlighting.</span>
</span><span data-line="96"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="97">        <span class="c1"># Build base graph</span>
</span><span data-line="98">        <span class="n">base_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_definition_graph</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span><span data-line="99">        <span class="n">lines</span> <span class="o">=</span> <span class="n">base_graph</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="100">
</span><span data-line="101">        <span class="c1"># Build step status map</span>
</span><span data-line="102">        <span class="n">step_statuses</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="103">        <span class="k">for</span> <span class="n">execution</span> <span class="ow">in</span> <span class="n">step_history</span><span class="p">:</span>
</span><span data-line="104">            <span class="n">status_key</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
</span><span data-line="105">            <span class="k">if</span> <span class="n">execution</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">StepStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">:</span>
</span><span data-line="106">                <span class="n">status_key</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
</span><span data-line="107">            <span class="k">elif</span> <span class="n">execution</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">StepStatus</span><span class="o">.</span><span class="n">SKIPPED</span><span class="p">:</span>
</span><span data-line="108">                <span class="n">status_key</span> <span class="o">=</span> <span class="s2">&quot;skipped&quot;</span>
</span><span data-line="109">            <span class="n">step_statuses</span><span class="p">[</span><span class="n">execution</span><span class="o">.</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">status_key</span>
</span><span data-line="110">
</span><span data-line="111">        <span class="k">if</span> <span class="n">current_step</span><span class="p">:</span>
</span><span data-line="112">            <span class="n">step_statuses</span><span class="p">[</span><span class="n">current_step</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;running&quot;</span>
</span><span data-line="113">
</span><span data-line="114">        <span class="c1"># Add styling</span>
</span><span data-line="115">        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">step_statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="116">            <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_STYLES</span><span class="p">:</span>
</span><span data-line="117">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    style </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">STATUS_STYLES</span><span class="p">[</span><span class="n">status</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="118">
</span><span data-line="119">        <span class="c1"># Add click handlers for interactive graphs</span>
</span><span data-line="120">        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span data-line="121">        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%%</span><span class="s2"> Click handlers for step details&quot;</span><span class="p">)</span>
</span><span data-line="122">        <span class="k">for</span> <span class="n">step_name</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
</span><span data-line="123">            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    click </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s1"> &quot;/workflows/steps/</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
</span><span data-line="124">
</span><span data-line="125">        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="graph-controller">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Graph Controller</a><a class="headerlink" href="#graph-controller" title="Link to this heading">¶</a></h3>
<p>Controller for graph visualization endpoints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">GraphController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;API for workflow graph visualization.</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">    Provides MermaidJS graph representations of workflow definitions</span>
</span><span data-line="9"><span class="sd">    and instances with execution state highlighting.</span>
</span><span data-line="10"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/graphs&quot;</span>
</span><span data-line="13">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Workflow Graphs&quot;</span><span class="p">]</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="16">        <span class="s2">&quot;/definitions/{name:str}&quot;</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Get definition graph&quot;</span><span class="p">,</span>
</span><span data-line="18">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns MermaidJS graph for a workflow definition.&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="p">)</span>
</span><span data-line="20">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_definition_graph</span><span class="p">(</span>
</span><span data-line="21">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="22">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="23">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="24">        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TD&quot;</span><span class="p">,</span>
</span><span data-line="25">        <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mermaid&quot;</span><span class="p">,</span>
</span><span data-line="26">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphResponseDTO</span><span class="p">:</span>
</span><span data-line="27"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get workflow definition as MermaidJS graph.&quot;&quot;&quot;</span>
</span><span data-line="28">        <span class="n">definition</span> <span class="o">=</span> <span class="n">workflow_registry</span><span class="o">.</span><span class="n">get_definition</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="29">        <span class="n">graph_service</span> <span class="o">=</span> <span class="n">GraphService</span><span class="p">()</span>
</span><span data-line="30">        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph_service</span><span class="o">.</span><span class="n">generate_definition_graph</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32">        <span class="k">return</span> <span class="n">GraphResponseDTO</span><span class="p">(</span>
</span><span data-line="33">            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
</span><span data-line="34">            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
</span><span data-line="35">            <span class="n">workflow_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="36">            <span class="n">workflow_version</span><span class="o">=</span><span class="n">definition</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
</span><span data-line="37">        <span class="p">)</span>
</span><span data-line="38">
</span><span data-line="39">    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="40">        <span class="s2">&quot;/instances/{instance_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="41">        <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Get instance graph&quot;</span><span class="p">,</span>
</span><span data-line="42">        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Returns MermaidJS graph with execution state.&quot;</span><span class="p">,</span>
</span><span data-line="43">    <span class="p">)</span>
</span><span data-line="44">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_instance_graph</span><span class="p">(</span>
</span><span data-line="45">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="46">        <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span>
</span><span data-line="47">        <span class="n">workflow_engine</span><span class="p">:</span> <span class="n">PersistentExecutionEngine</span><span class="p">,</span>
</span><span data-line="48">        <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="49">        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TD&quot;</span><span class="p">,</span>
</span><span data-line="50">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphResponseDTO</span><span class="p">:</span>
</span><span data-line="51"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get workflow instance graph with execution state.&quot;&quot;&quot;</span>
</span><span data-line="52">        <span class="n">instance</span> <span class="o">=</span> <span class="k">await</span> <span class="n">workflow_engine</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">instance_id</span><span class="p">)</span>
</span><span data-line="53">        <span class="n">definition</span> <span class="o">=</span> <span class="n">workflow_registry</span><span class="o">.</span><span class="n">get_definition</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">)</span>
</span><span data-line="54">
</span><span data-line="55">        <span class="n">graph_service</span> <span class="o">=</span> <span class="n">GraphService</span><span class="p">()</span>
</span><span data-line="56">        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph_service</span><span class="o">.</span><span class="n">generate_instance_graph</span><span class="p">(</span>
</span><span data-line="57">            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
</span><span data-line="58">            <span class="n">current_step</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">current_step</span><span class="p">,</span>
</span><span data-line="59">            <span class="n">step_history</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="60">                <span class="n">StepExecutionDTO</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span data-line="61">                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">step_history</span>
</span><span data-line="62">            <span class="p">],</span>
</span><span data-line="63">            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
</span><span data-line="64">        <span class="p">)</span>
</span><span data-line="65">
</span><span data-line="66">        <span class="k">return</span> <span class="n">GraphResponseDTO</span><span class="p">(</span>
</span><span data-line="67">            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
</span><span data-line="68">            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mermaid&quot;</span><span class="p">,</span>
</span><span data-line="69">            <span class="n">workflow_name</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">,</span>
</span><span data-line="70">            <span class="n">workflow_version</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">workflow_version</span><span class="p">,</span>
</span><span data-line="71">            <span class="n">instance_id</span><span class="o">=</span><span class="n">instance_id</span><span class="p">,</span>
</span><span data-line="72">            <span class="n">instance_status</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="73">        <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="graph-response-dto">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Graph Response DTO</a><a class="headerlink" href="#graph-response-dto" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">GraphResponseDTO</span><span class="p">(</span><span class="n">Struct</span><span class="p">):</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DTO for graph visualization response.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="n">graph</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># MermaidJS graph definition</span>
</span><span data-line="4">    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &quot;mermaid&quot; or &quot;svg&quot;</span>
</span><span data-line="5">    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="6">    <span class="n">workflow_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="7">    <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="8">    <span class="n">instance_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
</section>
<section id="dependency-injection-patterns">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Dependency Injection Patterns</a><a class="headerlink" href="#dependency-injection-patterns" title="Link to this heading">¶</a></h2>
<section id="repository-providers">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Repository Providers</a><a class="headerlink" href="#repository-providers" title="Link to this heading">¶</a></h3>
<p>DI providers for repository instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="5">    <span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
</span><span data-line="6">    <span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.db</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="7">        <span class="n">WorkflowDefinitionRepository</span><span class="p">,</span>
</span><span data-line="8">        <span class="n">WorkflowInstanceRepository</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">HumanTaskRepository</span><span class="p">,</span>
</span><span data-line="10">    <span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_definition_repo</span><span class="p">(</span>
</span><span data-line="13">    <span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span>
</span><span data-line="14"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowDefinitionRepository</span><span class="p">:</span>
</span><span data-line="15"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide workflow definition repository.&quot;&quot;&quot;</span>
</span><span data-line="16">    <span class="k">return</span> <span class="n">WorkflowDefinitionRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_instance_repo</span><span class="p">(</span>
</span><span data-line="19">    <span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span>
</span><span data-line="20"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInstanceRepository</span><span class="p">:</span>
</span><span data-line="21"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide workflow instance repository.&quot;&quot;&quot;</span>
</span><span data-line="22">    <span class="k">return</span> <span class="n">WorkflowInstanceRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_task_repo</span><span class="p">(</span>
</span><span data-line="25">    <span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span>
</span><span data-line="26"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HumanTaskRepository</span><span class="p">:</span>
</span><span data-line="27"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide human task repository.&quot;&quot;&quot;</span>
</span><span data-line="28">    <span class="k">return</span> <span class="n">HumanTaskRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="engine-provider">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Engine Provider</a><a class="headerlink" href="#engine-provider" title="Link to this heading">¶</a></h3>
<p>DI provider for the execution engine:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_engine</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">workflow_registry</span><span class="p">:</span> <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="4"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PersistentExecutionEngine</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide persistent execution engine.</span>
</span><span data-line="6">
</span><span data-line="7"><span class="sd">    The engine is created per-request with the request&#39;s database session</span>
</span><span data-line="8"><span class="sd">    to ensure proper transaction management.</span>
</span><span data-line="9"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="10">    <span class="k">return</span> <span class="n">PersistentExecutionEngine</span><span class="p">(</span>
</span><span data-line="11">        <span class="n">registry</span><span class="o">=</span><span class="n">workflow_registry</span><span class="p">,</span>
</span><span data-line="12">        <span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">,</span>
</span><span data-line="13">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="dependency-registration">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Dependency Registration</a><a class="headerlink" href="#dependency-registration" title="Link to this heading">¶</a></h3>
<p>The plugin registers dependencies during initialization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span><span class="w"> </span><span class="nf">_register_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="n">AppConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register dependency providers with the application.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Repository providers</span>
</span><span data-line="6">    <span class="n">app_config</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">dependency_key_definition_repo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Provide</span><span class="p">(</span>
</span><span data-line="7">        <span class="n">provide_definition_repo</span><span class="p">,</span>
</span><span data-line="8">        <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="9">    <span class="p">)</span>
</span><span data-line="10">    <span class="n">app_config</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">dependency_key_instance_repo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Provide</span><span class="p">(</span>
</span><span data-line="11">        <span class="n">provide_instance_repo</span><span class="p">,</span>
</span><span data-line="12">        <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="13">    <span class="p">)</span>
</span><span data-line="14">    <span class="n">app_config</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">dependency_key_task_repo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Provide</span><span class="p">(</span>
</span><span data-line="15">        <span class="n">provide_task_repo</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="17">    <span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19">    <span class="c1"># Engine provider</span>
</span><span data-line="20">    <span class="n">app_config</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">dependency_key_engine</span><span class="p">]</span> <span class="o">=</span> <span class="n">Provide</span><span class="p">(</span>
</span><span data-line="21">        <span class="n">provide_engine</span><span class="p">,</span>
</span><span data-line="22">        <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="23">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="dependency-composition">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Dependency Composition</a><a class="headerlink" href="#dependency-composition" title="Link to this heading">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">Request
</span><span data-line="2">    |
</span><span data-line="3">    +-- db_session (from SQLAlchemy plugin or user config)
</span><span data-line="4">    |       |
</span><span data-line="5">    |       +-- workflow_definition_repo
</span><span data-line="6">    |       +-- workflow_instance_repo
</span><span data-line="7">    |       +-- workflow_task_repo
</span><span data-line="8">    |       |
</span><span data-line="9">    |       +-- workflow_registry (singleton)
</span><span data-line="10">    |               |
</span><span data-line="11">    |               +-- workflow_engine (per-request)
</span></pre></div>
</div>
</section>
</section>
<section id="exception-handling">
<h2><a class="toc-backref" href="#id37" role="doc-backlink">Exception Handling</a><a class="headerlink" href="#exception-handling" title="Link to this heading">¶</a></h2>
<section id="web-specific-exceptions">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Web-Specific Exceptions</a><a class="headerlink" href="#web-specific-exceptions" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPException</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowWebException</span><span class="p">(</span><span class="n">HTTPException</span><span class="p">):</span>
</span><span data-line="4"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base exception for workflow web errors.&quot;&quot;&quot;</span>
</span><span data-line="5">    <span class="k">pass</span>
</span><span data-line="6">
</span><span data-line="7"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowNotFoundException</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="8"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a workflow or instance is not found.&quot;&quot;&quot;</span>
</span><span data-line="9">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">404</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="12">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="k">class</span><span class="w"> </span><span class="nc">InstanceNotFoundException</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="15"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a workflow instance is not found.&quot;&quot;&quot;</span>
</span><span data-line="16">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">404</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="19">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Workflow instance &#39;</span><span class="si">{</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="k">class</span><span class="w"> </span><span class="nc">TaskNotFoundException</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="22"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a human task is not found.&quot;&quot;&quot;</span>
</span><span data-line="23">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">404</span>
</span><span data-line="24">
</span><span data-line="25">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="26">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Task &#39;</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28"><span class="k">class</span><span class="w"> </span><span class="nc">TaskNotAssignedError</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="29"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when user is not assigned to a task.&quot;&quot;&quot;</span>
</span><span data-line="30">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">403</span>
</span><span data-line="31">
</span><span data-line="32">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="33">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="34">            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39; is not assigned to task &#39;</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span data-line="35">        <span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37"><span class="k">class</span><span class="w"> </span><span class="nc">InvalidTransitionError</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="38"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an invalid workflow transition is attempted.&quot;&quot;&quot;</span>
</span><span data-line="39">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">409</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="42">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="n">detail</span><span class="p">)</span>
</span><span data-line="43">
</span><span data-line="44"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInProgressError</span><span class="p">(</span><span class="n">WorkflowWebException</span><span class="p">):</span>
</span><span data-line="45"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when operation requires workflow to be complete.&quot;&quot;&quot;</span>
</span><span data-line="46">    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">409</span>
</span><span data-line="47">
</span><span data-line="48">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">current_status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="49">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="50">            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">&#39; is still in progress (status: </span><span class="si">{</span><span class="n">current_status</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span data-line="51">        <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="exception-handlers">
<h3><a class="toc-backref" href="#id39" role="doc-backlink">Exception Handlers</a><a class="headerlink" href="#exception-handlers" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPException</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="4">    <span class="n">WorkflowNotFoundError</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">StepExecutionError</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">InvalidTransitionError</span> <span class="k">as</span> <span class="n">CoreInvalidTransitionError</span><span class="p">,</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">workflow_not_found_handler</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">exc</span><span class="p">:</span> <span class="n">WorkflowNotFoundError</span><span class="p">,</span>
</span><span data-line="12"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span data-line="13"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle workflow not found errors.&quot;&quot;&quot;</span>
</span><span data-line="14">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span><span data-line="15">        <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;workflow_not_found&quot;</span><span class="p">},</span>
</span><span data-line="16">        <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
</span><span data-line="17">    <span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">step_execution_handler</span><span class="p">(</span>
</span><span data-line="20">    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="21">    <span class="n">exc</span><span class="p">:</span> <span class="n">StepExecutionError</span><span class="p">,</span>
</span><span data-line="22"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span data-line="23"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle step execution errors.&quot;&quot;&quot;</span>
</span><span data-line="24">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span><span data-line="25">        <span class="n">content</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="26">            <span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
</span><span data-line="27">            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;step_execution_error&quot;</span><span class="p">,</span>
</span><span data-line="28">            <span class="s2">&quot;step_name&quot;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="n">step_name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="s2">&quot;step_name&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="29">        <span class="p">},</span>
</span><span data-line="30">        <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
</span><span data-line="31">    <span class="p">)</span>
</span><span data-line="32">
</span><span data-line="33"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invalid_transition_handler</span><span class="p">(</span>
</span><span data-line="34">    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span><span data-line="35">    <span class="n">exc</span><span class="p">:</span> <span class="n">CoreInvalidTransitionError</span><span class="p">,</span>
</span><span data-line="36"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span data-line="37"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle invalid workflow transition errors.&quot;&quot;&quot;</span>
</span><span data-line="38">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span><span data-line="39">        <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;invalid_transition&quot;</span><span class="p">},</span>
</span><span data-line="40">        <span class="n">status_code</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span>
</span><span data-line="41">    <span class="p">)</span>
</span><span data-line="42">
</span><span data-line="43"><span class="n">WORKFLOW_EXCEPTION_HANDLERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="44">    <span class="n">WorkflowNotFoundError</span><span class="p">:</span> <span class="n">workflow_not_found_handler</span><span class="p">,</span>
</span><span data-line="45">    <span class="n">StepExecutionError</span><span class="p">:</span> <span class="n">step_execution_handler</span><span class="p">,</span>
</span><span data-line="46">    <span class="n">CoreInvalidTransitionError</span><span class="p">:</span> <span class="n">invalid_transition_handler</span><span class="p">,</span>
</span><span data-line="47"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="integration-example">
<h2><a class="toc-backref" href="#id40" role="doc-backlink">Integration Example</a><a class="headerlink" href="#integration-example" title="Link to this heading">¶</a></h2>
<section id="complete-application-setup">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Complete Application Setup</a><a class="headerlink" href="#complete-application-setup" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemyPlugin</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPlugin</span><span class="p">,</span> <span class="n">WorkflowPluginConfig</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowWebPlugin</span><span class="p">,</span> <span class="n">WorkflowWebPluginConfig</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Workflow definitions</span>
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderApprovalWorkflow</span><span class="p">,</span> <span class="n">DocumentReviewWorkflow</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Custom guards</span>
</span><span data-line="10"><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.guards</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthGuard</span><span class="p">,</span> <span class="n">AdminGuard</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Create workflow plugin</span>
</span><span data-line="13"><span class="n">workflow_plugin</span> <span class="o">=</span> <span class="n">WorkflowPlugin</span><span class="p">(</span>
</span><span data-line="14">    <span class="n">config</span><span class="o">=</span><span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="15">        <span class="n">auto_register_workflows</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="16">            <span class="n">OrderApprovalWorkflow</span><span class="p">,</span>
</span><span data-line="17">            <span class="n">DocumentReviewWorkflow</span><span class="p">,</span>
</span><span data-line="18">        <span class="p">],</span>
</span><span data-line="19">    <span class="p">)</span>
</span><span data-line="20"><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># Create web plugin</span>
</span><span data-line="23"><span class="n">web_plugin</span> <span class="o">=</span> <span class="n">WorkflowWebPlugin</span><span class="p">(</span>
</span><span data-line="24">    <span class="n">config</span><span class="o">=</span><span class="n">WorkflowWebPluginConfig</span><span class="p">(</span>
</span><span data-line="25">        <span class="n">path_prefix</span><span class="o">=</span><span class="s2">&quot;/api/workflows&quot;</span><span class="p">,</span>
</span><span data-line="26">        <span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">AuthGuard</span><span class="p">],</span>
</span><span data-line="27">        <span class="n">admin_guards</span><span class="o">=</span><span class="p">[</span><span class="n">AdminGuard</span><span class="p">],</span>
</span><span data-line="28">        <span class="n">task_guards</span><span class="o">=</span><span class="p">[</span><span class="n">AuthGuard</span><span class="p">],</span>
</span><span data-line="29">        <span class="n">enable_graph_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="30">    <span class="p">)</span>
</span><span data-line="31"><span class="p">)</span>
</span><span data-line="32">
</span><span data-line="33"><span class="c1"># Create Litestar application</span>
</span><span data-line="34"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="35">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Your other routes</span>
</span><span data-line="36">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="37">        <span class="n">SQLAlchemyPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=...</span><span class="p">),</span>
</span><span data-line="38">        <span class="n">workflow_plugin</span><span class="p">,</span>
</span><span data-line="39">        <span class="n">web_plugin</span><span class="p">,</span>
</span><span data-line="40">    <span class="p">],</span>
</span><span data-line="41">    <span class="n">openapi_config</span><span class="o">=</span><span class="n">OpenAPIConfig</span><span class="p">(</span>
</span><span data-line="42">        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My Application API&quot;</span><span class="p">,</span>
</span><span data-line="43">        <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span data-line="44">    <span class="p">),</span>
</span><span data-line="45"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="api-usage-examples">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">API Usage Examples</a><a class="headerlink" href="#api-usage-examples" title="Link to this heading">¶</a></h3>
<p>Starting a workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/workflows/api/instances<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span data-line="5"><span class="s1">    &quot;workflow_name&quot;: &quot;order_approval&quot;,</span>
</span><span data-line="6"><span class="s1">    &quot;initial_data&quot;: {</span>
</span><span data-line="7"><span class="s1">      &quot;order_id&quot;: &quot;ORD-123&quot;,</span>
</span><span data-line="8"><span class="s1">      &quot;amount&quot;: 1500.00,</span>
</span><span data-line="9"><span class="s1">      &quot;customer_id&quot;: &quot;CUST-456&quot;</span>
</span><span data-line="10"><span class="s1">    }</span>
</span><span data-line="11"><span class="s1">  }&#39;</span>
</span></pre></div>
</div>
<p>Listing pending tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/api/workflows/api/tasks<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>
</span></pre></div>
</div>
<p>Completing a task:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/workflows/api/tasks/<span class="o">{</span>task_id<span class="o">}</span>/complete<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span data-line="5"><span class="s1">    &quot;form_data&quot;: {</span>
</span><span data-line="6"><span class="s1">      &quot;approved&quot;: true,</span>
</span><span data-line="7"><span class="s1">      &quot;comments&quot;: &quot;Approved per policy guidelines&quot;</span>
</span><span data-line="8"><span class="s1">    }</span>
</span><span data-line="9"><span class="s1">  }&#39;</span>
</span></pre></div>
</div>
<p>Getting workflow graph:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/api/workflows/graphs/instances/<span class="o">{</span>instance_id<span class="o">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="testing-strategy">
<h2><a class="toc-backref" href="#id43" role="doc-backlink">Testing Strategy</a><a class="headerlink" href="#testing-strategy" title="Link to this heading">¶</a></h2>
<section id="unit-tests">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">Unit Tests</a><a class="headerlink" href="#unit-tests" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.testing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowWebPlugin</span>
</span><span data-line="4">
</span><span data-line="5"><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
</span><span data-line="6"><span class="k">def</span><span class="w"> </span><span class="nf">client</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
</span><span data-line="7">    <span class="k">return</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="k">class</span><span class="w"> </span><span class="nc">TestWorkflowDefinitionController</span><span class="p">:</span>
</span><span data-line="10">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_list_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
</span><span data-line="11">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/workflows/api/definitions&quot;</span><span class="p">)</span>
</span><span data-line="12">        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span><span data-line="13">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_get_definition_not_found</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
</span><span data-line="16">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/workflows/api/definitions/nonexistent&quot;</span><span class="p">)</span>
</span><span data-line="17">        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span>
</span><span data-line="18">
</span><span data-line="19"><span class="k">class</span><span class="w"> </span><span class="nc">TestWorkflowInstanceController</span><span class="p">:</span>
</span><span data-line="20">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_start_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">auth_headers</span><span class="p">):</span>
</span><span data-line="21">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="22">            <span class="s2">&quot;/api/workflows/api/instances&quot;</span><span class="p">,</span>
</span><span data-line="23">            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_workflow&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_data&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span data-line="24">            <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">,</span>
</span><span data-line="25">        <span class="p">)</span>
</span><span data-line="26">        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
</span><span data-line="27">        <span class="k">assert</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span data-line="28">
</span><span data-line="29"><span class="k">class</span><span class="w"> </span><span class="nc">TestHumanTaskController</span><span class="p">:</span>
</span><span data-line="30">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_complete_task_unauthorized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">other_user_task_id</span><span class="p">):</span>
</span><span data-line="31">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="32">            <span class="sa">f</span><span class="s2">&quot;/api/workflows/api/tasks/</span><span class="si">{</span><span class="n">other_user_task_id</span><span class="si">}</span><span class="s2">/complete&quot;</span><span class="p">,</span>
</span><span data-line="33">            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;form_data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;approved&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
</span><span data-line="34">        <span class="p">)</span>
</span><span data-line="35">        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span>
</span></pre></div>
</div>
</section>
<section id="integration-tests">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Integration Tests</a><a class="headerlink" href="#integration-tests" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_full_workflow_lifecycle</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">auth_headers</span><span class="p">):</span>
</span><span data-line="3">    <span class="c1"># Start workflow</span>
</span><span data-line="4">    <span class="n">start_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="5">        <span class="s2">&quot;/api/workflows/api/instances&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="s2">&quot;approval_workflow&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}},</span>
</span><span data-line="7">        <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">,</span>
</span><span data-line="8">    <span class="p">)</span>
</span><span data-line="9">    <span class="n">instance_id</span> <span class="o">=</span> <span class="n">start_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="c1"># Wait for human task</span>
</span><span data-line="12">    <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="13">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="c1"># Get pending tasks</span>
</span><span data-line="16">    <span class="n">tasks_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="17">        <span class="s2">&quot;/api/workflows/api/tasks&quot;</span><span class="p">,</span>
</span><span data-line="18">        <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">,</span>
</span><span data-line="19">    <span class="p">)</span>
</span><span data-line="20">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks_response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span data-line="21">    <span class="n">task_id</span> <span class="o">=</span> <span class="n">tasks_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</span><span data-line="22">
</span><span data-line="23">    <span class="c1"># Complete task</span>
</span><span data-line="24">    <span class="n">complete_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="25">        <span class="sa">f</span><span class="s2">&quot;/api/workflows/api/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/complete&quot;</span><span class="p">,</span>
</span><span data-line="26">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;form_data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;approved&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
</span><span data-line="27">        <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">,</span>
</span><span data-line="28">    <span class="p">)</span>
</span><span data-line="29">    <span class="k">assert</span> <span class="n">complete_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span><span data-line="30">
</span><span data-line="31">    <span class="c1"># Verify workflow completed</span>
</span><span data-line="32">    <span class="n">instance_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="33">        <span class="sa">f</span><span class="s2">&quot;/api/workflows/api/instances/</span><span class="si">{</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="34">        <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">,</span>
</span><span data-line="35">    <span class="p">)</span>
</span><span data-line="36">    <span class="k">assert</span> <span class="n">instance_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span>
</span></pre></div>
</div>
</section>
</section>
<section id="implementation-checklist">
<h2><a class="toc-backref" href="#id46" role="doc-backlink">Implementation Checklist</a><a class="headerlink" href="#implementation-checklist" title="Link to this heading">¶</a></h2>
<section id="phase-3-1-core-infrastructure">
<h3><a class="toc-backref" href="#id47" role="doc-backlink">Phase 3.1: Core Infrastructure</a><a class="headerlink" href="#phase-3-1-core-infrastructure" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Create <code class="docutils literal notranslate"><span class="pre">web/</span></code> module structure</p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowWebPluginConfig</span></code> dataclass</p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowWebPlugin</span></code> class with <code class="docutils literal notranslate"><span class="pre">on_app_init</span></code></p></li>
<li><p>[ ] Create base exception hierarchy</p></li>
<li><p>[ ] Register exception handlers</p></li>
</ul>
</section>
<section id="phase-3-2-dto-layer">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">Phase 3.2: DTO Layer</a><a class="headerlink" href="#phase-3-2-dto-layer" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Implement base DTO classes with msgspec</p></li>
<li><p>[ ] Create workflow definition DTOs</p></li>
<li><p>[ ] Create workflow instance DTOs</p></li>
<li><p>[ ] Create human task DTOs</p></li>
<li><p>[ ] Create graph response DTOs</p></li>
<li><p>[ ] Add validation constraints</p></li>
<li><p>[ ] Add OpenAPI examples</p></li>
</ul>
</section>
<section id="phase-3-3-controllers">
<h3><a class="toc-backref" href="#id49" role="doc-backlink">Phase 3.3: Controllers</a><a class="headerlink" href="#phase-3-3-controllers" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowDefinitionController</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowInstanceController</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">HumanTaskController</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowAdminController</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">GraphController</span></code></p></li>
<li><p>[ ] Add comprehensive docstrings for OpenAPI</p></li>
</ul>
</section>
<section id="phase-3-4-guards">
<h3><a class="toc-backref" href="#id50" role="doc-backlink">Phase 3.4: Guards</a><a class="headerlink" href="#phase-3-4-guards" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">BaseWorkflowGuard</span></code> protocol</p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowAuthGuard</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">WorkflowAdminGuard</span></code></p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">TaskAssigneeGuard</span></code></p></li>
<li><p>[ ] Document guard customization</p></li>
</ul>
</section>
<section id="phase-3-5-graph-service">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">Phase 3.5: Graph Service</a><a class="headerlink" href="#phase-3-5-graph-service" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">GraphService</span></code> class</p></li>
<li><p>[ ] Add MermaidJS generation for definitions</p></li>
<li><p>[ ] Add state highlighting for instances</p></li>
<li><p>[ ] Support multiple graph directions</p></li>
</ul>
</section>
<section id="phase-3-6-di-integration">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">Phase 3.6: DI Integration</a><a class="headerlink" href="#phase-3-6-di-integration" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Create repository providers</p></li>
<li><p>[ ] Create engine provider</p></li>
<li><p>[ ] Implement dependency registration</p></li>
<li><p>[ ] Document DI customization</p></li>
</ul>
</section>
<section id="phase-3-7-testing">
<h3><a class="toc-backref" href="#id53" role="doc-backlink">Phase 3.7: Testing</a><a class="headerlink" href="#phase-3-7-testing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] Unit tests for all controllers</p></li>
<li><p>[ ] Unit tests for DTOs</p></li>
<li><p>[ ] Unit tests for guards</p></li>
<li><p>[ ] Integration tests for full workflows</p></li>
<li><p>[ ] OpenAPI schema validation tests</p></li>
</ul>
</section>
<section id="phase-3-8-documentation">
<h3><a class="toc-backref" href="#id54" role="doc-backlink">Phase 3.8: Documentation</a><a class="headerlink" href="#phase-3-8-documentation" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[ ] API usage guide</p></li>
<li><p>[ ] Guard customization guide</p></li>
<li><p>[ ] DTO customization guide</p></li>
<li><p>[ ] OpenAPI integration guide</p></li>
</ul>
</section>
</section>
<section id="migration-guide">
<h2><a class="toc-backref" href="#id55" role="doc-backlink">Migration Guide</a><a class="headerlink" href="#migration-guide" title="Link to this heading">¶</a></h2>
<section id="from-manual-routes">
<h3><a class="toc-backref" href="#id56" role="doc-backlink">From Manual Routes</a><a class="headerlink" href="#from-manual-routes" title="Link to this heading">¶</a></h3>
<p>If you have existing manual routes, migrate to the plugin:</p>
<p><strong>Before:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/workflows/start&quot;</span><span class="p">)</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_workflow</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">instance</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">start_workflow</span><span class="p">(</span><span class="n">MyWorkflow</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span data-line="4">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>
</span></pre></div>
</div>
<p><strong>After:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Remove manual routes, use plugin</span>
</span><span data-line="2"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">WorkflowWebPlugin</span><span class="p">()],</span>
</span><span data-line="4"><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Access via: POST /workflows/api/instances</span>
</span></pre></div>
</div>
</section>
<section id="from-v0-3-x">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">From v0.3.x</a><a class="headerlink" href="#from-v0-3-x" title="Link to this heading">¶</a></h3>
<p>The web plugin replaces manual controller implementations:</p>
<ol class="arabic simple">
<li><p>Remove custom workflow controllers</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">WorkflowWebPlugin</span></code> to your app</p></li>
<li><p>Configure guards via <code class="docutils literal notranslate"><span class="pre">WorkflowWebPluginConfig</span></code></p></li>
<li><p>Update frontend to use new endpoint paths</p></li>
</ol>
</section>
</section>
<section id="see-also">
<h2><a class="toc-backref" href="#id58" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../guides/persistence.html"><span class="doc">Database Persistence</span></a> - Database persistence setup</p></li>
<li><p><a class="reference internal" href="../concepts/execution.html"><span class="doc">Execution</span></a> - Execution engine concepts</p></li>
<li><p><a class="reference internal" href="../guides/human-tasks.html"><span class="doc">Working with Human Tasks</span></a> - Human task workflows</p></li>
<li><p><a class="reference internal" href="../api/index.html"><span class="doc">API Reference</span></a> - Complete API reference</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="index.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Architecture Documentation</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../changelog.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Changelog</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/litestar-workflows" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>