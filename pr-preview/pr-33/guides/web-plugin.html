<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Web Plugin (REST API) - litestar-workflows</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Cookbook" href="../cookbook/index.html" /><link rel="prev" title="Database Persistence" href="persistence.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=8975404a" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Web Plugin (REST API)"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>litestar-workflows</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://pypi.org/project/litestar-workflows/">
            <span>PyPI</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/litestar-workflows" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Learn</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/workflows.html">Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/steps.html">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/context.html">Workflow Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/execution.html">Execution</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simple-workflow.html">Building a Simple Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="human-tasks.html">Working with Human Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel-execution.html">Parallel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional-logic.html">Conditional Logic and Gateways</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistence.html">Database Persistence</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Web Plugin (REST API)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/expense-approval.html">Expense Approval Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/document-review.html">Document Review Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/onboarding.html">Employee Onboarding Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/integration-patterns.html">Integration Patterns</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/modules.html">Module Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/web.html">Web Plugin API Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture/phase3-web.html">Phase 3: Web Plugin Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JacobCoffee/litestar-workflows">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/litestar-919193495116337154">Discord</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#why-use-the-rest-api">Why Use the REST API?</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
<li><a class="reference internal" href="#disabling-the-api">Disabling the API</a></li>
<li><a class="reference internal" href="#full-setup-with-persistence">Full Setup with Persistence</a></li>
<li><a class="reference internal" href="#rest-api-endpoints">REST API Endpoints</a><ul>
<li><a class="reference internal" href="#workflow-definitions">Workflow Definitions</a></li>
<li><a class="reference internal" href="#workflow-instances">Workflow Instances</a></li>
<li><a class="reference internal" href="#human-tasks">Human Tasks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-and-authorization">Authentication and Authorization</a><ul>
<li><a class="reference internal" href="#basic-authentication-guard">Basic Authentication Guard</a></li>
<li><a class="reference internal" href="#role-based-admin-guard">Role-Based Admin Guard</a></li>
<li><a class="reference internal" href="#jwt-authentication-example">JWT Authentication Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openapi-schema-customization">OpenAPI Schema Customization</a><ul>
<li><a class="reference internal" href="#default-tags">Default Tags</a></li>
<li><a class="reference internal" href="#custom-tags">Custom Tags</a></li>
<li><a class="reference internal" href="#excluding-from-schema">Excluding from Schema</a></li>
<li><a class="reference internal" href="#per-environment-configuration">Per-Environment Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mermaidjs-graph-visualization">MermaidJS Graph Visualization</a><ul>
<li><a class="reference internal" href="#definition-graph">Definition Graph</a></li>
<li><a class="reference internal" href="#instance-graph-with-state">Instance Graph with State</a></li>
<li><a class="reference internal" href="#rendering-in-html">Rendering in HTML</a></li>
<li><a class="reference internal" href="#node-shapes-by-step-type">Node Shapes by Step Type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-transfer-objects-dtos">Data Transfer Objects (DTOs)</a><ul>
<li><a class="reference internal" href="#request-dtos">Request DTOs</a></li>
<li><a class="reference internal" href="#response-dtos">Response DTOs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-full-web-api-integration">Example: Full Web API Integration</a><ul>
<li><a class="reference internal" href="#backend-setup">Backend Setup</a></li>
<li><a class="reference internal" href="#frontend-task-inbox">Frontend Task Inbox</a></li>
<li><a class="reference internal" href="#starting-workflows-from-ui">Starting Workflows from UI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li><a class="reference internal" href="#use-guards-consistently">Use Guards Consistently</a></li>
<li><a class="reference internal" href="#scope-dependencies-properly">Scope Dependencies Properly</a></li>
<li><a class="reference internal" href="#monitor-task-completion">Monitor Task Completion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">litestar-workflows</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">How-To Guides</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Web Plugin (REST API)</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="web-plugin-rest-api">
<h1>Web Plugin (REST API)<a class="headerlink" href="#web-plugin-rest-api" title="Link to this heading">¶</a></h1>
<p>This guide covers integrating the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> extra to add a complete REST API
for workflow management. The REST API is built into the main <code class="docutils literal notranslate"><span class="pre">WorkflowPlugin</span></code>
and enabled by default, automatically registering routes for workflow definitions,
instances, and human tasks with full OpenAPI support.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/workflow-list.png"><img alt="Workflow List UI" src="../_images/workflow-list.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">The built-in web UI showing registered workflows</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/workflow-detail.png"><img alt="Workflow Detail UI" src="../_images/workflow-detail.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">Workflow detail view with step visualization</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<section id="why-use-the-rest-api">
<h2>Why Use the REST API?<a class="headerlink" href="#why-use-the-rest-api" title="Link to this heading">¶</a></h2>
<p>While you can build custom API routes for workflow management (as shown in
<a class="reference internal" href="human-tasks.html"><span class="doc">Working with Human Tasks</span></a>), the built-in REST API provides a production-ready solution:</p>
<p><strong>Without the built-in API:</strong></p>
<ul class="simple">
<li><p>You must implement all CRUD endpoints manually</p></li>
<li><p>OpenAPI documentation requires manual configuration</p></li>
<li><p>Authentication and authorization are handled per-endpoint</p></li>
<li><p>Graph visualization needs custom implementation</p></li>
</ul>
<p><strong>With the built-in API (enabled by default):</strong></p>
<ul class="simple">
<li><p>Complete REST API for workflows out of the box</p></li>
<li><p>Automatic OpenAPI schema generation with detailed descriptions</p></li>
<li><p>Centralized authentication via Litestar guards</p></li>
<li><p>Built-in MermaidJS graph visualization endpoints</p></li>
</ul>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>Install the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> extra (which includes <code class="docutils literal notranslate"><span class="pre">[db]</span></code> as a dependency):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">pip<span class="w"> </span>install<span class="w"> </span>litestar-workflows<span class="o">[</span>web<span class="o">]</span>
</span></pre></div>
</div>
<p>This adds:</p>
<ul class="simple">
<li><p><strong>litestar-workflows[db]</strong>: Database persistence layer</p></li>
<li><p><strong>advanced-alchemy</strong>: Repository pattern implementation</p></li>
</ul>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h2>
<p>The REST API is enabled by default when you add the <code class="docutils literal notranslate"><span class="pre">WorkflowPlugin</span></code> to your
Litestar application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPlugin</span><span class="p">,</span> <span class="n">WorkflowPluginConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="7">        <span class="n">WorkflowPlugin</span><span class="p">(</span>
</span><span data-line="8">            <span class="n">config</span><span class="o">=</span><span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="9">                <span class="n">enable_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Default - API auto-enabled</span>
</span><span data-line="10">                <span class="n">api_path_prefix</span><span class="o">=</span><span class="s2">&quot;/workflows&quot;</span><span class="p">,</span>
</span><span data-line="11">            <span class="p">)</span>
</span><span data-line="12">        <span class="p">),</span>
</span><span data-line="13">    <span class="p">],</span>
</span><span data-line="14"><span class="p">)</span>
</span></pre></div>
</div>
<p>That’s it! Your application now has workflow API routes at <code class="docutils literal notranslate"><span class="pre">/workflows/*</span></code>.</p>
</section>
<section id="configuration-options">
<h2>Configuration Options<a class="headerlink" href="#configuration-options" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">WorkflowPluginConfig</span></code> dataclass controls the REST API behavior:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPluginConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="c1"># Enable/disable REST API endpoints (default: True)</span>
</span><span data-line="5">    <span class="n">enable_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># URL path prefix for all workflow endpoints</span>
</span><span data-line="8">    <span class="n">api_path_prefix</span><span class="o">=</span><span class="s2">&quot;/api/v1/workflows&quot;</span><span class="p">,</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># Include endpoints in OpenAPI schema (default: True)</span>
</span><span data-line="11">    <span class="n">include_api_in_schema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="c1"># Apply guards to all workflow endpoints</span>
</span><span data-line="14">    <span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">require_auth_guard</span><span class="p">],</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="c1"># OpenAPI tags for organization</span>
</span><span data-line="17">    <span class="n">api_tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Workflows&quot;</span><span class="p">],</span>
</span><span data-line="18"><span class="p">)</span>
</span></pre></div>
</div>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 15.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enable_api</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Enable REST API endpoints</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">api_path_prefix</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;/workflows&quot;</span></code></p></td>
<td><p>Base URL path for all workflow routes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">include_api_in_schema</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Include routes in OpenAPI documentation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">api_guards</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p>List of Litestar guards applied to all routes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">api_tags</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;Workflows&quot;]</span></code></p></td>
<td><p>OpenAPI tags for route grouping</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="disabling-the-api">
<h2>Disabling the API<a class="headerlink" href="#disabling-the-api" title="Link to this heading">¶</a></h2>
<p>If you only need the core workflow functionality without REST endpoints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPlugin</span><span class="p">,</span> <span class="n">WorkflowPluginConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="5">        <span class="n">WorkflowPlugin</span><span class="p">(</span>
</span><span data-line="6">            <span class="n">config</span><span class="o">=</span><span class="n">WorkflowPluginConfig</span><span class="p">(</span><span class="n">enable_api</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="7">        <span class="p">),</span>
</span><span data-line="8">    <span class="p">],</span>
</span><span data-line="9"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="full-setup-with-persistence">
<h2>Full Setup with Persistence<a class="headerlink" href="#full-setup-with-persistence" title="Link to this heading">¶</a></h2>
<p>For a complete setup with database persistence:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span><span class="p">,</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">AsyncSession</span>
</span><span data-line="4">
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPlugin</span><span class="p">,</span> <span class="n">WorkflowPluginConfig</span><span class="p">,</span> <span class="n">WorkflowRegistry</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentExecutionEngine</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Database setup</span>
</span><span data-line="9"><span class="n">db_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
</span><span data-line="10">    <span class="s2">&quot;postgresql+asyncpg://user:pass@localhost/workflows&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13"><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">db_engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Workflow registry with your definitions</span>
</span><span data-line="16"><span class="n">registry</span> <span class="o">=</span> <span class="n">WorkflowRegistry</span><span class="p">()</span>
</span><span data-line="17"><span class="n">registry</span><span class="o">.</span><span class="n">register_definition</span><span class="p">(</span><span class="n">ApprovalWorkflow</span><span class="o">.</span><span class="n">get_definition</span><span class="p">())</span>
</span><span data-line="18"><span class="n">registry</span><span class="o">.</span><span class="n">register_workflow_class</span><span class="p">(</span><span class="n">ApprovalWorkflow</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20">
</span><span data-line="21"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_session</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncSession</span><span class="p">:</span>
</span><span data-line="22"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide database session.&quot;&quot;&quot;</span>
</span><span data-line="23">    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="24">        <span class="k">yield</span> <span class="n">session</span>
</span><span data-line="25">
</span><span data-line="26">
</span><span data-line="27"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_engine</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PersistentExecutionEngine</span><span class="p">:</span>
</span><span data-line="28"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide workflow execution engine.&quot;&quot;&quot;</span>
</span><span data-line="29">    <span class="k">return</span> <span class="n">PersistentExecutionEngine</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">registry</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="30">
</span><span data-line="31">
</span><span data-line="32"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_registry</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">WorkflowRegistry</span><span class="p">:</span>
</span><span data-line="33"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide workflow registry.&quot;&quot;&quot;</span>
</span><span data-line="34">    <span class="k">return</span> <span class="n">registry</span>
</span><span data-line="35">
</span><span data-line="36">
</span><span data-line="37"><span class="c1"># Create app with plugins</span>
</span><span data-line="38"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="39">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="40">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="41">        <span class="n">WorkflowPlugin</span><span class="p">(</span>
</span><span data-line="42">            <span class="n">config</span><span class="o">=</span><span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="43">                <span class="n">auto_register_workflows</span><span class="o">=</span><span class="p">[</span><span class="n">ApprovalWorkflow</span><span class="p">],</span>
</span><span data-line="44">                <span class="n">enable_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="45">                <span class="n">api_path_prefix</span><span class="o">=</span><span class="s2">&quot;/api/workflows&quot;</span><span class="p">,</span>
</span><span data-line="46">            <span class="p">)</span>
</span><span data-line="47">        <span class="p">),</span>
</span><span data-line="48">    <span class="p">],</span>
</span><span data-line="49">    <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="50">        <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_session</span><span class="p">),</span>
</span><span data-line="51">        <span class="s2">&quot;workflow_engine&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_engine</span><span class="p">),</span>
</span><span data-line="52">        <span class="s2">&quot;workflow_registry&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_registry</span><span class="p">),</span>
</span><span data-line="53">    <span class="p">},</span>
</span><span data-line="54"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="rest-api-endpoints">
<h2>REST API Endpoints<a class="headerlink" href="#rest-api-endpoints" title="Link to this heading">¶</a></h2>
<p>The plugin registers three controller groups under the configured path prefix.</p>
<section id="workflow-definitions">
<h3>Workflow Definitions<a class="headerlink" href="#workflow-definitions" title="Link to this heading">¶</a></h3>
<p>Manage registered workflow definitions:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 15.0%" />
<col style="width: 35.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Endpoint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/definitions</span></code></p></td>
<td><p>List all registered workflow definitions</p></td>
</tr>
<tr class="row-odd"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/definitions/{name}</span></code></p></td>
<td><p>Get a specific definition by name</p></td>
</tr>
<tr class="row-even"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/definitions/{name}/graph</span></code></p></td>
<td><p>Get workflow graph visualization</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>List Definitions:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/definitions
</span></pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">[</span>
</span><span data-line="2"><span class="w">  </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;expense_approval&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Multi-level expense approval workflow&quot;</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="nt">&quot;steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;finance_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;process&quot;</span><span class="p">],</span>
</span><span data-line="7"><span class="w">    </span><span class="nt">&quot;edges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="8"><span class="w">      </span><span class="p">{</span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">},</span>
</span><span data-line="9"><span class="w">      </span><span class="p">{</span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;finance_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">}</span>
</span><span data-line="10"><span class="w">    </span><span class="p">],</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">&quot;initial_step&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">&quot;terminal_steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span data-line="13"><span class="w">  </span><span class="p">}</span>
</span><span data-line="14"><span class="p">]</span>
</span></pre></div>
</div>
<p><strong>Get Definition:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/definitions/expense_approval
</span></pre></div>
</div>
<p><strong>Get Definition Graph:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># MermaidJS format (default)</span>
</span><span data-line="2">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/definitions/expense_approval/graph?graph_format=mermaid&quot;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># JSON format</span>
</span><span data-line="5">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/definitions/expense_approval/graph?graph_format=json&quot;</span>
</span></pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">&quot;mermaid_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;graph TD\n    submit[Submit]\n    manager_approval{{Manager Approval}}\n    ...&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="4"><span class="w">    </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;machine&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_initial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_terminal&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
</span><span data-line="5"><span class="w">  </span><span class="p">],</span>
</span><span data-line="6"><span class="w">  </span><span class="nt">&quot;edges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="7"><span class="w">    </span><span class="p">{</span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">}</span>
</span><span data-line="8"><span class="w">  </span><span class="p">]</span>
</span><span data-line="9"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="workflow-instances">
<h3>Workflow Instances<a class="headerlink" href="#workflow-instances" title="Link to this heading">¶</a></h3>
<p>Start and manage workflow executions:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 15.0%" />
<col style="width: 35.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Endpoint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>POST</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances</span></code></p></td>
<td><p>Start a new workflow instance</p></td>
</tr>
<tr class="row-odd"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances</span></code></p></td>
<td><p>List instances (with filtering)</p></td>
</tr>
<tr class="row-even"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances/{id}</span></code></p></td>
<td><p>Get detailed instance information</p></td>
</tr>
<tr class="row-odd"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances/{id}/graph</span></code></p></td>
<td><p>Get instance graph with execution state</p></td>
</tr>
<tr class="row-even"><td><p>POST</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances/{id}/cancel</span></code></p></td>
<td><p>Cancel a running workflow</p></td>
</tr>
<tr class="row-odd"><td><p>POST</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/instances/{id}/retry</span></code></p></td>
<td><p>Retry a failed workflow</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Start Workflow:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/workflows/instances<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span data-line="4"><span class="s1">    &quot;definition_name&quot;: &quot;expense_approval&quot;,</span>
</span><span data-line="5"><span class="s1">    &quot;input_data&quot;: {</span>
</span><span data-line="6"><span class="s1">      &quot;requester&quot;: &quot;alice@example.com&quot;,</span>
</span><span data-line="7"><span class="s1">      &quot;amount&quot;: 2500.00,</span>
</span><span data-line="8"><span class="s1">      &quot;description&quot;: &quot;Conference attendance&quot;</span>
</span><span data-line="9"><span class="s1">    },</span>
</span><span data-line="10"><span class="s1">    &quot;user_id&quot;: &quot;alice@example.com&quot;</span>
</span><span data-line="11"><span class="s1">  }&#39;</span>
</span></pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nt">&quot;definition_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;expense_approval&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;running&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">&quot;current_step&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span>
</span><span data-line="6"><span class="w">  </span><span class="nt">&quot;started_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-25T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span data-line="8"><span class="w">  </span><span class="nt">&quot;created_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
</span><span data-line="9"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>List Instances with Filters:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Filter by status</span>
</span><span data-line="2">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/instances?status=waiting&quot;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Filter by workflow name</span>
</span><span data-line="5">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/instances?workflow_name=expense_approval&quot;</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Pagination</span>
</span><span data-line="8">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/instances?limit=20&amp;offset=0&quot;</span>
</span></pre></div>
</div>
<p><strong>Get Instance Details:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/instances/550e8400-e29b-41d4-a716-446655440000
</span></pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nt">&quot;definition_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;expense_approval&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;waiting&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">&quot;current_step&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span>
</span><span data-line="6"><span class="w">  </span><span class="nt">&quot;started_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-25T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span data-line="8"><span class="w">  </span><span class="nt">&quot;created_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
</span><span data-line="9"><span class="w">  </span><span class="nt">&quot;context_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="nt">&quot;requester&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">2500.00</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Conference attendance&quot;</span><span class="p">,</span>
</span><span data-line="13"><span class="w">    </span><span class="nt">&quot;submitted&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span data-line="14"><span class="w">  </span><span class="p">},</span>
</span><span data-line="15"><span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span data-line="16"><span class="w">  </span><span class="nt">&quot;step_history&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="17"><span class="w">    </span><span class="p">{</span>
</span><span data-line="18"><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;step-exec-001&quot;</span><span class="p">,</span>
</span><span data-line="19"><span class="w">      </span><span class="nt">&quot;step_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span>
</span><span data-line="20"><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;succeeded&quot;</span><span class="p">,</span>
</span><span data-line="21"><span class="w">      </span><span class="nt">&quot;started_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-25T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="22"><span class="w">      </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-25T10:30:01Z&quot;</span><span class="p">,</span>
</span><span data-line="23"><span class="w">      </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span data-line="24"><span class="w">    </span><span class="p">}</span>
</span><span data-line="25"><span class="w">  </span><span class="p">],</span>
</span><span data-line="26"><span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span data-line="27"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Get Instance Graph with State:</strong></p>
<p>The instance graph endpoint returns a MermaidJS diagram with the current
execution state highlighted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/instances/550e8400.../graph
</span></pre></div>
</div>
<p>Response shows completed steps in green, current in yellow, failed in red:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">{
</span><span data-line="2">  &quot;mermaid_source&quot;: &quot;graph TD\n    submit[Submit]\n    ...\n    style submit fill:#90EE90,stroke:#006400&quot;,
</span><span data-line="3">  &quot;nodes&quot;: [...],
</span><span data-line="4">  &quot;edges&quot;: [...]
</span><span data-line="5">}
</span></pre></div>
</div>
<p><strong>Cancel Instance:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/instances/550e8400.../cancel?reason=No%20longer%20needed&quot;</span>
</span></pre></div>
</div>
</section>
<section id="human-tasks">
<h3>Human Tasks<a class="headerlink" href="#human-tasks" title="Link to this heading">¶</a></h3>
<p>Manage pending human approval tasks:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 15.0%" />
<col style="width: 35.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Endpoint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tasks</span></code></p></td>
<td><p>List tasks (with filtering)</p></td>
</tr>
<tr class="row-odd"><td><p>GET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tasks/{id}</span></code></p></td>
<td><p>Get task details with form schema</p></td>
</tr>
<tr class="row-even"><td><p>POST</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tasks/{id}/complete</span></code></p></td>
<td><p>Complete task with form data</p></td>
</tr>
<tr class="row-odd"><td><p>POST</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tasks/{id}/reassign</span></code></p></td>
<td><p>Reassign task to another user</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>List Tasks:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># List pending tasks</span>
</span><span data-line="2">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/tasks?status=pending&quot;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Filter by assignee</span>
</span><span data-line="5">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/tasks?assignee_id=manager@example.com&quot;</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Filter by group</span>
</span><span data-line="8">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/tasks?assignee_group=managers&quot;</span>
</span></pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">[</span>
</span><span data-line="2"><span class="w">  </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;660e8400-e29b-41d4-a716-446655440001&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="nt">&quot;instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">    </span><span class="nt">&quot;step_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Manager Approval&quot;</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Review and approve expense request&quot;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="nt">&quot;assignee&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager@example.com&quot;</span><span class="p">,</span>
</span><span data-line="9"><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
</span><span data-line="10"><span class="w">    </span><span class="nt">&quot;due_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-26T10:30:00Z&quot;</span><span class="p">,</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-25T10:30:01Z&quot;</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">&quot;form_schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span data-line="14"><span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="15"><span class="w">        </span><span class="nt">&quot;approved&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Approve?&quot;</span><span class="p">},</span>
</span><span data-line="16"><span class="w">        </span><span class="nt">&quot;comments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Comments&quot;</span><span class="p">}</span>
</span><span data-line="17"><span class="w">      </span><span class="p">},</span>
</span><span data-line="18"><span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;approved&quot;</span><span class="p">]</span>
</span><span data-line="19"><span class="w">    </span><span class="p">}</span>
</span><span data-line="20"><span class="w">  </span><span class="p">}</span>
</span><span data-line="21"><span class="p">]</span>
</span></pre></div>
</div>
<p><strong>Get Task Detail:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/tasks/660e8400...
</span></pre></div>
</div>
<p><strong>Complete Task:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/workflows/tasks/660e8400.../complete<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span data-line="4"><span class="s1">    &quot;output_data&quot;: {</span>
</span><span data-line="5"><span class="s1">      &quot;approved&quot;: true,</span>
</span><span data-line="6"><span class="s1">      &quot;comments&quot;: &quot;Approved for Q4 budget&quot;</span>
</span><span data-line="7"><span class="s1">    },</span>
</span><span data-line="8"><span class="s1">    &quot;completed_by&quot;: &quot;manager@example.com&quot;</span>
</span><span data-line="9"><span class="s1">  }&#39;</span>
</span></pre></div>
</div>
<p><strong>Reassign Task:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/workflows/tasks/660e8400.../reassign<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span data-line="4"><span class="s1">    &quot;new_assignee&quot;: &quot;other-manager@example.com&quot;,</span>
</span><span data-line="5"><span class="s1">    &quot;reason&quot;: &quot;Original assignee on vacation&quot;</span>
</span><span data-line="6"><span class="s1">  }&#39;</span>
</span></pre></div>
</div>
</section>
</section>
<section id="authentication-and-authorization">
<h2>Authentication and Authorization<a class="headerlink" href="#authentication-and-authorization" title="Link to this heading">¶</a></h2>
<p>Secure your workflow routes using Litestar guards.</p>
<section id="basic-authentication-guard">
<h3>Basic Authentication Guard<a class="headerlink" href="#basic-authentication-guard" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.handlers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRouteHandler</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotAuthorizedException</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">auth_guard</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="8"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Require authenticated user for workflow operations.&quot;&quot;&quot;</span>
</span><span data-line="10">    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="11">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">
</span><span data-line="14"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="15">    <span class="n">api_path_prefix</span><span class="o">=</span><span class="s2">&quot;/api/workflows&quot;</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">auth_guard</span><span class="p">],</span>
</span><span data-line="17"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="role-based-admin-guard">
<h3>Role-Based Admin Guard<a class="headerlink" href="#role-based-admin-guard" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">admin_guard</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="4"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Require admin role for administrative operations.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="7">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">if</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;roles&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span data-line="10">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Admin access required&quot;</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Apply different guards to different routes by extending controllers</span>
</span><span data-line="14"><span class="c1"># or using middleware</span>
</span></pre></div>
</div>
</section>
<section id="jwt-authentication-example">
<h3>JWT Authentication Example<a class="headerlink" href="#jwt-authentication-example" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.security.jwt</span><span class="w"> </span><span class="kn">import</span> <span class="n">JWTAuth</span><span class="p">,</span> <span class="n">Token</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPlugin</span><span class="p">,</span> <span class="n">WorkflowPluginConfig</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Define your user model</span>
</span><span data-line="6"><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">:</span>
</span><span data-line="7">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">roles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span data-line="8">        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
</span><span data-line="9">        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
</span><span data-line="10">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="n">roles</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># JWT configuration</span>
</span><span data-line="13"><span class="n">jwt_auth</span> <span class="o">=</span> <span class="n">JWTAuth</span><span class="p">[</span><span class="n">User</span><span class="p">](</span>
</span><span data-line="14">    <span class="n">retrieve_user_handler</span><span class="o">=</span><span class="n">retrieve_user_from_token</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">token_secret</span><span class="o">=</span><span class="s2">&quot;your-secret-key&quot;</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="s2">&quot;/docs&quot;</span><span class="p">],</span>
</span><span data-line="17"><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">workflow_auth_guard</span><span class="p">(</span>
</span><span data-line="20">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="21">    <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="22"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="23">    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="24">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Please log in&quot;</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="27">    <span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">workflow_auth_guard</span><span class="p">],</span>
</span><span data-line="28"><span class="p">)</span>
</span><span data-line="29">
</span><span data-line="30"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="31">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">WorkflowPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)],</span>
</span><span data-line="32">    <span class="n">on_app_init</span><span class="o">=</span><span class="p">[</span><span class="n">jwt_auth</span><span class="o">.</span><span class="n">on_app_init</span><span class="p">],</span>
</span><span data-line="33"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="openapi-schema-customization">
<h2>OpenAPI Schema Customization<a class="headerlink" href="#openapi-schema-customization" title="Link to this heading">¶</a></h2>
<p>The plugin generates comprehensive OpenAPI documentation automatically.</p>
<section id="default-tags">
<h3>Default Tags<a class="headerlink" href="#default-tags" title="Link to this heading">¶</a></h3>
<p>Routes are tagged by default:</p>
<ul class="simple">
<li><p><strong>Workflow Definitions</strong>: Definition management endpoints</p></li>
<li><p><strong>Workflow Instances</strong>: Instance lifecycle endpoints</p></li>
<li><p><strong>Human Tasks</strong>: Task management endpoints</p></li>
</ul>
</section>
<section id="custom-tags">
<h3>Custom Tags<a class="headerlink" href="#custom-tags" title="Link to this heading">¶</a></h3>
<p>Override the default tags:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">api_tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Business Processes&quot;</span><span class="p">,</span> <span class="s2">&quot;Approvals&quot;</span><span class="p">],</span>
</span><span data-line="3"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="excluding-from-schema">
<h3>Excluding from Schema<a class="headerlink" href="#excluding-from-schema" title="Link to this heading">¶</a></h3>
<p>Hide workflow routes from public API documentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">include_api_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Routes work but don&#39;t appear in docs</span>
</span><span data-line="3"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="per-environment-configuration">
<h3>Per-Environment Configuration<a class="headerlink" href="#per-environment-configuration" title="Link to this heading">¶</a></h3>
<p>Show detailed endpoints only in development:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">include_api_in_schema</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ENV&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="mermaidjs-graph-visualization">
<h2>MermaidJS Graph Visualization<a class="headerlink" href="#mermaidjs-graph-visualization" title="Link to this heading">¶</a></h2>
<p>The plugin includes endpoints for rendering workflow graphs as MermaidJS diagrams,
which can be embedded in web UIs or documentation.</p>
<section id="definition-graph">
<h3>Definition Graph<a class="headerlink" href="#definition-graph" title="Link to this heading">¶</a></h3>
<p>Get the static workflow structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/workflows/definitions/expense_approval/graph?graph_format=mermaid&quot;</span>
</span></pre></div>
</div>
<p>Response includes both the MermaidJS source and structured data:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">&quot;mermaid_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;graph TD\n    submit[Submit Request]\n    manager_approval{{Manager Approval}}\n    submit --&gt; manager_approval&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="4"><span class="w">    </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Submit Request&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;machine&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_initial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_terminal&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span>
</span><span data-line="5"><span class="w">    </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Manager Approval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;human&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_initial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;is_terminal&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
</span><span data-line="6"><span class="w">  </span><span class="p">],</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">&quot;edges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="8"><span class="w">    </span><span class="p">{</span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manager_approval&quot;</span><span class="p">}</span>
</span><span data-line="9"><span class="w">  </span><span class="p">]</span>
</span><span data-line="10"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="instance-graph-with-state">
<h3>Instance Graph with State<a class="headerlink" href="#instance-graph-with-state" title="Link to this heading">¶</a></h3>
<p>Get a workflow graph showing execution progress:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>http://localhost:8000/workflows/instances/<span class="o">{</span>id<span class="o">}</span>/graph
</span></pre></div>
</div>
<p>The MermaidJS includes styling to show:</p>
<ul class="simple">
<li><p><strong>Completed steps</strong>: Green highlighting (<code class="docutils literal notranslate"><span class="pre">fill:#90EE90</span></code>)</p></li>
<li><p><strong>Current step</strong>: Yellow highlighting (<code class="docutils literal notranslate"><span class="pre">fill:#FFD700</span></code>)</p></li>
<li><p><strong>Failed steps</strong>: Red highlighting (<code class="docutils literal notranslate"><span class="pre">fill:#FF6B6B</span></code>)</p></li>
</ul>
</section>
<section id="rendering-in-html">
<h3>Rendering in HTML<a class="headerlink" href="#rendering-in-html" title="Link to this heading">¶</a></h3>
<p>Use the MermaidJS library to render graphs:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span data-line="2"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span data-line="3"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span data-line="4">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span data-line="5"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span data-line="6"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span data-line="7">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;workflow-graph&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span data-line="8">
</span><span data-line="9">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span data-line="10"><span class="w">    </span><span class="nx">mermaid</span><span class="p">.</span><span class="nx">initialize</span><span class="p">({</span><span class="w"> </span><span class="nx">startOnLoad</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
</span><span data-line="11">
</span><span data-line="12"><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadWorkflowGraph</span><span class="p">(</span><span class="nx">instanceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/workflows/instances/</span><span class="si">${</span><span class="nx">instanceId</span><span class="si">}</span><span class="sb">/graph`</span><span class="p">);</span>
</span><span data-line="14"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="15">
</span><span data-line="16"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;workflow-graph&#39;</span><span class="p">);</span>
</span><span data-line="17"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">svg</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mermaid</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">mermaid_source</span><span class="p">);</span>
</span><span data-line="18"><span class="w">      </span><span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">;</span>
</span><span data-line="19"><span class="w">    </span><span class="p">}</span>
</span><span data-line="20">
</span><span data-line="21"><span class="w">    </span><span class="nx">loadWorkflowGraph</span><span class="p">(</span><span class="s1">&#39;550e8400-e29b-41d4-a716-446655440000&#39;</span><span class="p">);</span>
</span><span data-line="22"><span class="w">  </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span data-line="23"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span data-line="24"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></pre></div>
</div>
</section>
<section id="node-shapes-by-step-type">
<h3>Node Shapes by Step Type<a class="headerlink" href="#node-shapes-by-step-type" title="Link to this heading">¶</a></h3>
<p>MermaidJS uses different shapes for different step types:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 30.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Step Type</p></th>
<th class="head"><p>Shape</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Machine</p></td>
<td><p>Rectangle <code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">submit[Submit]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Human</p></td>
<td><p>Hexagon <code class="docutils literal notranslate"><span class="pre">{{}}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">review{{Review}}</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Gateway</p></td>
<td><p>Diamond <code class="docutils literal notranslate"><span class="pre">{}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">decision{Check</span> <span class="pre">Amount}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Timer</p></td>
<td><p>Stadium <code class="docutils literal notranslate"><span class="pre">([])</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delay([Wait</span> <span class="pre">24h])</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Webhook</p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">[[]]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">callback[[Await</span> <span class="pre">Callback]]</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="data-transfer-objects-dtos">
<h2>Data Transfer Objects (DTOs)<a class="headerlink" href="#data-transfer-objects-dtos" title="Link to this heading">¶</a></h2>
<p>The REST API uses dataclass DTOs for request/response serialization:</p>
<section id="request-dtos">
<h3>Request DTOs<a class="headerlink" href="#request-dtos" title="Link to this heading">¶</a></h3>
<p><strong>StartWorkflowDTO:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@dataclass</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">StartWorkflowDTO</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">definition_name</span><span class="p">:</span> <span class="nb">str</span>                  <span class="c1"># Required: workflow to start</span>
</span><span data-line="4">    <span class="n">input_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>     <span class="c1"># Initial context data</span>
</span><span data-line="5">    <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>            <span class="c1"># Track related workflows</span>
</span><span data-line="6">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>                   <span class="c1"># Who started the workflow</span>
</span><span data-line="7">    <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>                 <span class="c1"># Multi-tenancy support</span>
</span></pre></div>
</div>
<p><strong>CompleteTaskDTO:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@dataclass</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">CompleteTaskDTO</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">output_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>           <span class="c1"># Form data submitted</span>
</span><span data-line="4">    <span class="n">completed_by</span><span class="p">:</span> <span class="nb">str</span>                     <span class="c1"># User completing the task</span>
</span><span data-line="5">    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>                   <span class="c1"># Optional comment</span>
</span></pre></div>
</div>
</section>
<section id="response-dtos">
<h3>Response DTOs<a class="headerlink" href="#response-dtos" title="Link to this heading">¶</a></h3>
<p><strong>WorkflowDefinitionDTO:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@dataclass</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowDefinitionDTO</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="4">    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="5">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="6">    <span class="n">steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="7">    <span class="n">edges</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span data-line="8">    <span class="n">initial_step</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="9">    <span class="n">terminal_steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></pre></div>
</div>
<p><strong>WorkflowInstanceDTO:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@dataclass</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowInstanceDTO</span><span class="p">:</span>
</span><span data-line="3">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="4">    <span class="n">definition_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="5">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="6">    <span class="n">current_step</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="7">    <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="8">    <span class="n">completed_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="9">    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span></pre></div>
</div>
<p><strong>HumanTaskDTO:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@dataclass</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">HumanTaskDTO</span><span class="p">:</span>
</span><span data-line="3">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="4">    <span class="n">instance_id</span><span class="p">:</span> <span class="n">UUID</span>
</span><span data-line="5">    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="6">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="7">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="8">    <span class="n">assignee</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="9">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="10">    <span class="n">due_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="11">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span data-line="12">    <span class="n">form_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
</section>
<section id="example-full-web-api-integration">
<h2>Example: Full Web API Integration<a class="headerlink" href="#example-full-web-api-integration" title="Link to this heading">¶</a></h2>
<p>Here’s a complete example integrating the REST API with authentication and a
frontend application.</p>
<section id="backend-setup">
<h3>Backend Setup<a class="headerlink" href="#backend-setup" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># app.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.handlers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRouteHandler</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotAuthorizedException</span>
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span><span class="p">,</span> <span class="n">async_sessionmaker</span>
</span><span data-line="8">
</span><span data-line="9"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="10">    <span class="n">WorkflowPlugin</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">WorkflowPluginConfig</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">WorkflowRegistry</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">WorkflowDefinition</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">Edge</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">BaseMachineStep</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">BaseHumanStep</span><span class="p">,</span>
</span><span data-line="17">    <span class="n">WorkflowContext</span><span class="p">,</span>
</span><span data-line="18"><span class="p">)</span>
</span><span data-line="19"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentExecutionEngine</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># Define workflow steps</span>
</span><span data-line="22"><span class="k">class</span><span class="w"> </span><span class="nc">SubmitRequest</span><span class="p">(</span><span class="n">BaseMachineStep</span><span class="p">):</span>
</span><span data-line="23">    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;submit&quot;</span>
</span><span data-line="24">    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Submit the request&quot;</span>
</span><span data-line="25">
</span><span data-line="26">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">WorkflowContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span data-line="27">        <span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;submitted&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span data-line="28">        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;submitted&quot;</span><span class="p">}</span>
</span><span data-line="29">
</span><span data-line="30"><span class="k">class</span><span class="w"> </span><span class="nc">ManagerReview</span><span class="p">(</span><span class="n">BaseHumanStep</span><span class="p">):</span>
</span><span data-line="31">    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;manager_review&quot;</span>
</span><span data-line="32">    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Review Request&quot;</span>
</span><span data-line="33">    <span class="n">form_schema</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="34">        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span data-line="35">        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="36">            <span class="s2">&quot;approved&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Approved&quot;</span><span class="p">},</span>
</span><span data-line="37">            <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Comments&quot;</span><span class="p">},</span>
</span><span data-line="38">        <span class="p">},</span>
</span><span data-line="39">        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;approved&quot;</span><span class="p">],</span>
</span><span data-line="40">    <span class="p">}</span>
</span><span data-line="41">
</span><span data-line="42"><span class="c1"># Define workflow</span>
</span><span data-line="43"><span class="k">class</span><span class="w"> </span><span class="nc">ApprovalWorkflow</span><span class="p">:</span>
</span><span data-line="44">    <span class="n">__workflow_name__</span> <span class="o">=</span> <span class="s2">&quot;approval&quot;</span>
</span><span data-line="45">    <span class="n">__workflow_version__</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>
</span><span data-line="46">    <span class="n">__workflow_description__</span> <span class="o">=</span> <span class="s2">&quot;Simple approval workflow&quot;</span>
</span><span data-line="47">
</span><span data-line="48">    <span class="nd">@classmethod</span>
</span><span data-line="49">    <span class="k">def</span><span class="w"> </span><span class="nf">get_definition</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowDefinition</span><span class="p">:</span>
</span><span data-line="50">        <span class="k">return</span> <span class="n">WorkflowDefinition</span><span class="p">(</span>
</span><span data-line="51">            <span class="n">name</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">__workflow_name__</span><span class="p">,</span>
</span><span data-line="52">            <span class="n">version</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">__workflow_version__</span><span class="p">,</span>
</span><span data-line="53">            <span class="n">description</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">__workflow_description__</span><span class="p">,</span>
</span><span data-line="54">            <span class="n">steps</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="55">                <span class="s2">&quot;submit&quot;</span><span class="p">:</span> <span class="n">SubmitRequest</span><span class="p">(),</span>
</span><span data-line="56">                <span class="s2">&quot;manager_review&quot;</span><span class="p">:</span> <span class="n">ManagerReview</span><span class="p">(),</span>
</span><span data-line="57">            <span class="p">},</span>
</span><span data-line="58">            <span class="n">edges</span><span class="o">=</span><span class="p">[</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="s2">&quot;manager_review&quot;</span><span class="p">)],</span>
</span><span data-line="59">            <span class="n">initial_step</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span>
</span><span data-line="60">            <span class="n">terminal_steps</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;manager_review&quot;</span><span class="p">},</span>
</span><span data-line="61">        <span class="p">)</span>
</span><span data-line="62">
</span><span data-line="63"><span class="c1"># Database setup</span>
</span><span data-line="64"><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://localhost/workflows&quot;</span><span class="p">)</span>
</span><span data-line="65"><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="66">
</span><span data-line="67"><span class="c1"># Registry</span>
</span><span data-line="68"><span class="n">registry</span> <span class="o">=</span> <span class="n">WorkflowRegistry</span><span class="p">()</span>
</span><span data-line="69"><span class="n">registry</span><span class="o">.</span><span class="n">register_definition</span><span class="p">(</span><span class="n">ApprovalWorkflow</span><span class="o">.</span><span class="n">get_definition</span><span class="p">())</span>
</span><span data-line="70"><span class="n">registry</span><span class="o">.</span><span class="n">register_workflow_class</span><span class="p">(</span><span class="n">ApprovalWorkflow</span><span class="p">)</span>
</span><span data-line="71">
</span><span data-line="72">
</span><span data-line="73"><span class="c1"># Dependency providers</span>
</span><span data-line="74"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_session</span><span class="p">():</span>
</span><span data-line="75">    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="76">        <span class="k">yield</span> <span class="n">session</span>
</span><span data-line="77">
</span><span data-line="78">
</span><span data-line="79"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_engine</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
</span><span data-line="80">    <span class="k">return</span> <span class="n">PersistentExecutionEngine</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">registry</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="81">
</span><span data-line="82">
</span><span data-line="83"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_registry</span><span class="p">():</span>
</span><span data-line="84">    <span class="k">return</span> <span class="n">registry</span>
</span><span data-line="85">
</span><span data-line="86">
</span><span data-line="87"><span class="c1"># Authentication guard</span>
</span><span data-line="88"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">require_auth</span><span class="p">(</span>
</span><span data-line="89">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="90">    <span class="n">route_handler</span><span class="p">:</span> <span class="n">BaseRouteHandler</span><span class="p">,</span>
</span><span data-line="91"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="92">    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="93">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="94">
</span><span data-line="95">
</span><span data-line="96"><span class="c1"># Health endpoint</span>
</span><span data-line="97"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">)</span>
</span><span data-line="98"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span data-line="99">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">}</span>
</span><span data-line="100">
</span><span data-line="101">
</span><span data-line="102"><span class="c1"># Create application</span>
</span><span data-line="103"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="104">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">health_check</span><span class="p">],</span>
</span><span data-line="105">    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="106">        <span class="n">WorkflowPlugin</span><span class="p">(</span>
</span><span data-line="107">            <span class="n">config</span><span class="o">=</span><span class="n">WorkflowPluginConfig</span><span class="p">(</span>
</span><span data-line="108">                <span class="n">auto_register_workflows</span><span class="o">=</span><span class="p">[</span><span class="n">ApprovalWorkflow</span><span class="p">],</span>
</span><span data-line="109">                <span class="n">enable_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="110">                <span class="n">api_path_prefix</span><span class="o">=</span><span class="s2">&quot;/api/workflows&quot;</span><span class="p">,</span>
</span><span data-line="111">                <span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">require_auth</span><span class="p">],</span>
</span><span data-line="112">                <span class="n">api_tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Workflow API&quot;</span><span class="p">],</span>
</span><span data-line="113">            <span class="p">)</span>
</span><span data-line="114">        <span class="p">),</span>
</span><span data-line="115">    <span class="p">],</span>
</span><span data-line="116">    <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="117">        <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_session</span><span class="p">),</span>
</span><span data-line="118">        <span class="s2">&quot;workflow_engine&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_engine</span><span class="p">),</span>
</span><span data-line="119">        <span class="s2">&quot;workflow_registry&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_registry</span><span class="p">),</span>
</span><span data-line="120">    <span class="p">},</span>
</span><span data-line="121"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="frontend-task-inbox">
<h3>Frontend Task Inbox<a class="headerlink" href="#frontend-task-inbox" title="Link to this heading">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// task-inbox.js</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kd">class</span><span class="w"> </span><span class="nx">TaskInbox</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">apiBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/api/workflows&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">apiBase</span><span class="p">;</span>
</span><span data-line="6"><span class="w">  </span><span class="p">}</span>
</span><span data-line="7">
</span><span data-line="8"><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">loadTasks</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span><span class="si">}</span><span class="sb">/tasks?status=pending`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getToken</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span>
</span><span data-line="11"><span class="w">    </span><span class="p">});</span>
</span><span data-line="12"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="13"><span class="w">  </span><span class="p">}</span>
</span><span data-line="14">
</span><span data-line="15"><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getTask</span><span class="p">(</span><span class="nx">taskId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="16"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span><span class="si">}</span><span class="sb">/tasks/</span><span class="si">${</span><span class="nx">taskId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="17"><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getToken</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span>
</span><span data-line="18"><span class="w">    </span><span class="p">});</span>
</span><span data-line="19"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="20"><span class="w">  </span><span class="p">}</span>
</span><span data-line="21">
</span><span data-line="22"><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">completeTask</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span><span class="w"> </span><span class="nx">formData</span><span class="p">,</span><span class="w"> </span><span class="nx">completedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="23"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span><span class="si">}</span><span class="sb">/tasks/</span><span class="si">${</span><span class="nx">taskId</span><span class="si">}</span><span class="sb">/complete`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="24"><span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span data-line="25"><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="26"><span class="w">        </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getToken</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span data-line="27"><span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span data-line="28"><span class="w">      </span><span class="p">},</span>
</span><span data-line="29"><span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span data-line="30"><span class="w">        </span><span class="nx">output_data</span><span class="o">:</span><span class="w"> </span><span class="nx">formData</span><span class="p">,</span>
</span><span data-line="31"><span class="w">        </span><span class="nx">completed_by</span><span class="o">:</span><span class="w"> </span><span class="nx">completedBy</span><span class="p">,</span>
</span><span data-line="32"><span class="w">      </span><span class="p">}),</span>
</span><span data-line="33"><span class="w">    </span><span class="p">});</span>
</span><span data-line="34">
</span><span data-line="35"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="36"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to complete task&#39;</span><span class="p">);</span>
</span><span data-line="37"><span class="w">    </span><span class="p">}</span>
</span><span data-line="38">
</span><span data-line="39"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="40"><span class="w">  </span><span class="p">}</span>
</span><span data-line="41">
</span><span data-line="42"><span class="w">  </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="43"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;auth_token&#39;</span><span class="p">);</span>
</span><span data-line="44"><span class="w">  </span><span class="p">}</span>
</span><span data-line="45"><span class="p">}</span>
</span><span data-line="46">
</span><span data-line="47"><span class="c1">// Usage</span>
</span><span data-line="48"><span class="kd">const</span><span class="w"> </span><span class="nx">inbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TaskInbox</span><span class="p">();</span>
</span><span data-line="49"><span class="nx">inbox</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="50"><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Pending tasks:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">tasks</span><span class="p">);</span>
</span><span data-line="51"><span class="p">});</span>
</span></pre></div>
</div>
</section>
<section id="starting-workflows-from-ui">
<h3>Starting Workflows from UI<a class="headerlink" href="#starting-workflows-from-ui" title="Link to this heading">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">startExpenseRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/workflows/instances&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">      </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">getToken</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span data-line="6"><span class="w">      </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="p">},</span>
</span><span data-line="8"><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span data-line="9"><span class="w">      </span><span class="nx">definition_name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;expense_approval&#39;</span><span class="p">,</span>
</span><span data-line="10"><span class="w">      </span><span class="nx">input_data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">        </span><span class="nx">requester</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span><span data-line="12"><span class="w">        </span><span class="nx">amount</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">amount</span><span class="p">,</span>
</span><span data-line="13"><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
</span><span data-line="14"><span class="w">      </span><span class="p">},</span>
</span><span data-line="15"><span class="w">      </span><span class="nx">user_id</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span><span data-line="16"><span class="w">    </span><span class="p">}),</span>
</span><span data-line="17"><span class="w">  </span><span class="p">});</span>
</span><span data-line="18">
</span><span data-line="19"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="20"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Failed to start workflow&#39;</span><span class="p">);</span>
</span><span data-line="21"><span class="w">  </span><span class="p">}</span>
</span><span data-line="22">
</span><span data-line="23"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="24"><span class="w">  </span><span class="nx">showNotification</span><span class="p">(</span><span class="sb">`Request submitted! ID: </span><span class="si">${</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span data-line="25"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">instance</span><span class="p">;</span>
</span><span data-line="26"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h2>
<p>The REST API uses standard HTTP status codes and Litestar exceptions:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 15.0%" />
<col style="width: 30.0%" />
<col style="width: 55.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Status</p></th>
<th class="head"><p>Exception</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>400</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ValidationException</span></code></p></td>
<td><p>Invalid request data or form submission</p></td>
</tr>
<tr class="row-odd"><td><p>401</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NotAuthorizedException</span></code></p></td>
<td><p>Authentication required</p></td>
</tr>
<tr class="row-even"><td><p>403</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PermissionDeniedException</span></code></p></td>
<td><p>Insufficient permissions</p></td>
</tr>
<tr class="row-odd"><td><p>404</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NotFoundException</span></code></p></td>
<td><p>Workflow, instance, or task not found</p></td>
</tr>
<tr class="row-even"><td><p>409</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ClientException</span></code></p></td>
<td><p>Invalid state transition</p></td>
</tr>
</tbody>
</table>
</div>
<p>Handle errors in your frontend:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">completeTask</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/workflows/tasks/</span><span class="si">${</span><span class="nx">taskId</span><span class="si">}</span><span class="sb">/complete`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
</span><span data-line="6"><span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">output_data</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">completed_by</span><span class="o">:</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="p">}),</span>
</span><span data-line="7"><span class="w">    </span><span class="p">});</span>
</span><span data-line="8">
</span><span data-line="9"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span data-line="11"><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="12"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">400</span><span class="o">:</span>
</span><span data-line="13"><span class="w">          </span><span class="nx">showFormErrors</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
</span><span data-line="14"><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="15"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">404</span><span class="o">:</span>
</span><span data-line="16"><span class="w">          </span><span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Task no longer exists&#39;</span><span class="p">);</span>
</span><span data-line="17"><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="18"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">409</span><span class="o">:</span>
</span><span data-line="19"><span class="w">          </span><span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Task already completed&#39;</span><span class="p">);</span>
</span><span data-line="20"><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="21"><span class="w">        </span><span class="k">default</span><span class="o">:</span>
</span><span data-line="22"><span class="w">          </span><span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;An error occurred&#39;</span><span class="p">);</span>
</span><span data-line="23"><span class="w">      </span><span class="p">}</span>
</span><span data-line="24"><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="25"><span class="w">    </span><span class="p">}</span>
</span><span data-line="26">
</span><span data-line="27"><span class="w">    </span><span class="nx">showSuccess</span><span class="p">(</span><span class="s1">&#39;Task completed!&#39;</span><span class="p">);</span>
</span><span data-line="28"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="29"><span class="w">    </span><span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Network error&#39;</span><span class="p">);</span>
</span><span data-line="30"><span class="w">  </span><span class="p">}</span>
</span><span data-line="31"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="use-guards-consistently">
<h3>Use Guards Consistently<a class="headerlink" href="#use-guards-consistently" title="Link to this heading">¶</a></h3>
<p>Always configure authentication for production:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ENV&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;development&quot;</span><span class="p">:</span>
</span><span data-line="4">    <span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">()</span>  <span class="c1"># No auth for easier testing</span>
</span><span data-line="5"><span class="k">else</span><span class="p">:</span>
</span><span data-line="6">    <span class="n">config</span> <span class="o">=</span> <span class="n">WorkflowPluginConfig</span><span class="p">(</span><span class="n">api_guards</span><span class="o">=</span><span class="p">[</span><span class="n">require_auth</span><span class="p">])</span>
</span></pre></div>
</div>
</section>
<section id="scope-dependencies-properly">
<h3>Scope Dependencies Properly<a class="headerlink" href="#scope-dependencies-properly" title="Link to this heading">¶</a></h3>
<p>Use request-scoped sessions for proper transaction management:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_session</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncSession</span><span class="p">:</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Each request gets its own session.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="4">        <span class="k">yield</span> <span class="n">session</span>
</span><span data-line="5">        <span class="c1"># Session automatically closed after request</span>
</span></pre></div>
</div>
</section>
<section id="monitor-task-completion">
<h3>Monitor Task Completion<a class="headerlink" href="#monitor-task-completion" title="Link to this heading">¶</a></h3>
<p>Track task completion times and SLA breaches:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_workflows.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">HumanTaskRepository</span>
</span><span data-line="4">
</span><span data-line="5"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/api/metrics/tasks&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">task_metrics</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span data-line="7">    <span class="n">repo</span> <span class="o">=</span> <span class="n">HumanTaskRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="8">    <span class="n">overdue</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">find_overdue</span><span class="p">()</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="k">return</span> <span class="p">{</span>
</span><span data-line="11">        <span class="s2">&quot;overdue_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">overdue</span><span class="p">),</span>
</span><span data-line="12">        <span class="s2">&quot;overdue_tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="13">            <span class="p">{</span>
</span><span data-line="14">                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span data-line="15">                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span><span data-line="16">                <span class="s2">&quot;hours_overdue&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span data-line="17">                    <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="o">.</span><span class="n">due_at</span>
</span><span data-line="18">                <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span>
</span><span data-line="19">            <span class="p">}</span>
</span><span data-line="20">            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">overdue</span>
</span><span data-line="21">        <span class="p">],</span>
</span><span data-line="22">    <span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="persistence.html"><span class="doc">Database Persistence</span></a> - Database persistence setup</p></li>
<li><p><a class="reference internal" href="human-tasks.html"><span class="doc">Working with Human Tasks</span></a> - Human task workflow patterns</p></li>
<li><p><a class="reference internal" href="../architecture/phase3-web.html"><span class="doc">Phase 3: Web Plugin Architecture</span></a> - Web plugin architecture details</p></li>
<li><p><a class="reference internal" href="../api/web.html"><span class="doc">Web Plugin API Reference</span></a> - Complete Web Plugin API reference</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="persistence.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Database Persistence</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../cookbook/index.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Cookbook</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/litestar-workflows" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>